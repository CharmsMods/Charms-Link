<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Image Tiler — Real-time</title><style>:root{--bg:#1a1a1a;--panel:#2a2a2a;--muted:#999999;--accent:#ffffff;--mono:12px/1 monospace}body,html{height:100%;margin:0;background:#1a1a1a;color:#fff;font-family:Inter,system-ui,ui-sans-serif,Segoe UI,Roboto,Helvetica,Arial,sans-serif}.wrap{max-width:1150px;margin:18px auto;padding:18px;background:#1a1a1a;border-radius:12px;display:grid;grid-template-columns:360px 1fr;gap:18px;border:1px solid #333}.panel{background:var(--panel);padding:14px;border-radius:10px;border:1px solid #333}h1{margin:0 0 10px 0;font-size:18px;color:#fff}label{display:block;font-size:12px;color:var(--muted);margin-top:8px}input[type=file]{width:100%;color:#fff}.row{display:flex;gap:8px;align-items:center;margin-top:8px}input[type=number],input[type=text],select{width:100%;padding:6px;border-radius:6px;border:1px solid #333;background:#2a2a2a;color:#fff;font-size:13px}.small{width:86px}button{background:#2a2a2a;border:1px solid #fff;color:#fff;padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer;transition:all .2s ease}button:hover{background:#3a3a3a}canvas{width:100%;height:auto;border-radius:8px;background:#1a1a1a;display:block;border:1px solid #333}.meta{font-size:12px;color:var(--muted);margin-top:8px}.downloads{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}a.dl{background:#2a2a2a;padding:8px 10px;border-radius:8px;color:#fff;text-decoration:none;font-size:13px;border:1px solid #333;transition:all .2s ease}a.dl:hover{background:#3a3a3a}.hint{font-size:12px;color:var(--muted);margin-top:6px}.controls{display:flex;flex-direction:column}.inline{display:flex;gap:8px}.preview-wrap{display:flex;flex-direction:column;gap:8px}.preview-canvas{width:100%;height:600px;display:flex;align-items:center;justify-content:center;background:#1a1a1a;border-radius:8px;overflow:hidden;border:1px solid #333}.note{font-size:12px;color:var(--muted)}footer{grid-column:1/-1;margin-top:8px;color:var(--muted);font-size:12px;text-align:center}select{background:#2a2a2a;color:#fff;border:1px solid #333}option{background:#2a2a2a;color:#fff}::placeholder{color:#666}input[type=file]::file-selector-button{background:#2a2a2a;color:#fff;border:1px solid #333;padding:4px 8px;border-radius:4px;margin-right:8px;cursor:pointer}</style></head><body><div class="wrap"><div class="panel controls"><h1>Image Tiler — real-time</h1><label>Choose image (PNG / JPG)</label> <input id="file" type="file" accept="image/png,image/jpeg"><div class="inline" style="margin-top:8px"><div style="flex:1"><label>Tiles (N or W x H)</label> <input id="tiles" type="text" placeholder="e.g. 3  or  4x2"></div><div style="width:86px"><label>Fit</label> <select id="target"><option value="full">full</option><option value="1024">1k</option><option value="2048">2k</option><option value="4096">4k</option><option value="8192">8k</option><option value="all">all</option></select></div></div><div class="inline" style="margin-top:8px"><div style="flex:1"><label>Horizontal spacing (px)</label> <input id="sx" type="number" value="0" min="0"></div><div style="width:120px"><label>Vertical spacing (px)</label> <input id="sy" type="number" value="0" min="0"></div></div><div style="margin-top:10px"><label>Preview quality</label> <select id="previewScale"><option value="auto">fit to panel</option><option value="1">100%</option><option value="0.75">75%</option><option value="0.5" selected="selected">50%</option><option value="0.25">25%</option></select></div><div class="row" style="margin-top:12px"><button id="render">Render now</button> <button id="downloadAll">Download selected</button> <button id="clear">Clear</button></div><div class="meta" id="meta">No image loaded.</div><div class="hint">Spacing gaps are filled by stretching the image's right/bottom edge and bottom-right corner pixels.</div><div style="margin-top:8px" class="downloads" id="downloads"></div></div><div class="panel preview-wrap"><div style="display:flex;justify-content:space-between;align-items:center"><div><strong>Preview</strong><div class="note">Realtime preview of the chosen output (resized to fit)</div></div><div class="note" id="sizeNote"></div></div><div class="preview-canvas"><canvas id="preview" width="1200" height="800"></canvas></div><div style="margin-top:8px;display:flex;gap:8px;align-items:center"><label style="margin:0">Show grid lines</label> <input id="grid" type="checkbox"> <label style="margin:0">Show tile borders</label> <input id="borders" type="checkbox"></div></div><footer>Outputs are generated in-memory and offered for download as PNG files. Large targets (4k/8k) may be slow or memory intensive depending on your browser.</footer></div><script>const fileInput=document.getElementById("file"),tilesInput=document.getElementById("tiles"),sxInput=document.getElementById("sx"),syInput=document.getElementById("sy"),targetSelect=document.getElementById("target"),previewCanvas=document.getElementById("preview"),previewCtx=previewCanvas.getContext("2d",{alpha:!0}),renderBtn=document.getElementById("render"),downloadsDiv=document.getElementById("downloads"),meta=document.getElementById("meta"),previewScaleSel=document.getElementById("previewScale"),downloadAllBtn=document.getElementById("downloadAll"),clearBtn=document.getElementById("clear"),sizeNote=document.getElementById("sizeNote"),gridCheckbox=document.getElementById("grid"),bordersCheckbox=document.getElementById("borders");let srcImage=null,srcCanvas=null,lastState={};function parseTiles(e){if(!(e=(e||"").trim()))return[3,3];if(e.includes("x")){const t=e.split("x").map(e=>parseInt(e.trim(),10));if(2===t.length&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return[Math.max(1,t[0]),Math.max(1,t[1])]}const t=parseInt(e,10);return Number.isInteger(t)?[Math.max(1,t),Math.max(1,t)]:[3,3]}function createCanvas(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,n}function loadImageFromFile(e){return new Promise((t,n)=>{const a=new Image;a.onload=()=>t(a),a.onerror=e=>n(e),a.src=URL.createObjectURL(e)})}async function handleFileChange(e){const t=e.target.files&&e.target.files[0];if(t)try{const e=await loadImageFromFile(t);srcCanvas=createCanvas(e.width,e.height);const n=srcCanvas.getContext("2d",{willReadFrequently:!0});n.clearRect(0,0,srcCanvas.width,srcCanvas.height),n.drawImage(e,0,0),srcImage=e,meta.textContent=`Loaded: ${t.name} — ${e.width} x ${e.height} px`,renderPreviewDebounced()}catch(e){meta.textContent="Error loading image",console.error(e)}}function buildTiledCanvas(e,t,n,a,r){const i=e.width,o=e.height,d=createCanvas(t*i+Math.max(0,t-1)*a,n*o+Math.max(0,n-1)*r),l=d.getContext("2d"),s=createCanvas(1,o);s.getContext("2d").drawImage(e,i-1,0,1,o,0,0,1,o);const c=createCanvas(i,1);c.getContext("2d").drawImage(e,0,o-1,i,1,0,0,i,1);const u=createCanvas(1,1);u.getContext("2d").drawImage(e,i-1,o-1,1,1,0,0,1,1);for(let d=0;d<n;d++)for(let m=0;m<t;m++){const h=m*(i+a),v=d*(o+r);l.drawImage(e,h,v),m<t-1&&a>0&&l.drawImage(s,0,0,1,o,h+i,v,a,o),d<n-1&&r>0&&l.drawImage(c,0,0,i,1,h,v+o,i,r),m<t-1&&d<n-1&&a>0&&r>0&&l.drawImage(u,0,0,1,1,h+i,v+o,a,r)}return d}function resizeToTarget(e,t){if("full"===t)return e;const n=parseInt(t,10);if(!n||n<=0)return e;const a=e.width,r=e.height,i=Math.max(a,r);if(i===n)return e;const o=n/i,d=Math.max(1,Math.round(a*o)),l=Math.max(1,Math.round(r*o)),s=createCanvas(d,l);return s.getContext("2d").imageSmoothingEnabled=!0,s.getContext("2d").imageSmoothingQuality="high",s.getContext("2d").drawImage(e,0,0,d,l),s}function drawPreview(e){const t=previewScaleSel.value;let n=1;if("auto"===t){const t=previewCanvas.clientWidth-20,a=previewCanvas.clientHeight-20;n=Math.min(1,t/e.width,a/e.height)}else n=parseFloat(t);const a=Math.max(200,Math.round(e.width*n)),r=Math.max(200,Math.round(e.height*n)),i=Math.min(a,2e3),o=Math.min(r,1200);previewCanvas.width=i,previewCanvas.height=o,previewCtx.clearRect(0,0,i,o),previewCtx.imageSmoothingEnabled=!0,previewCtx.imageSmoothingQuality="high";const d=Math.max(0,(i-a)/2),l=Math.max(0,(o-r)/2);if(previewCtx.fillStyle="#000",previewCtx.fillRect(0,0,i,o),previewCtx.drawImage(e,0,0,e.width,e.height,d,l,a,r),gridCheckbox.checked||bordersCheckbox.checked){previewCtx.save(),previewCtx.globalCompositeOperation="source-over",previewCtx.lineWidth=1,previewCtx.strokeStyle="rgba(255,255,255,0.08)";const[e,t]=parseTiles(tilesInput.value),s=parseInt(sxInput.value||"0",10),c=parseInt(syInput.value||"0",10),u=srcCanvas.width,m=srcCanvas.height,h=Math.round(u*n),v=Math.round(m*n),g=Math.round(s*n),w=Math.round(c*n);for(let t=1;t<e;t++){const e=d+t*(h+g)-g/2;previewCtx.beginPath(),previewCtx.moveTo(e,0),previewCtx.lineTo(e,o),previewCtx.stroke()}for(let e=1;e<t;e++){const t=l+e*(v+w)-w/2;previewCtx.beginPath(),previewCtx.moveTo(0,t),previewCtx.lineTo(i,t),previewCtx.stroke()}bordersCheckbox.checked&&(previewCtx.strokeStyle="rgba(255,255,255,0.14)",previewCtx.lineWidth=1.5,previewCtx.strokeRect(d+.5,l+.5,a-1,r-1)),previewCtx.restore()}}function makeDownloadLink(e,t){return new Promise(n=>{e.toBlob(e=>{const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,r.textContent="Save "+t,r.className="dl",n({el:r,url:a})},"image/png")})}async function generateOutputs(){if(!srcCanvas)return void(meta.textContent="No image loaded.");const[e,t]=parseTiles(tilesInput.value),n=Math.max(0,parseInt(sxInput.value||"0",10)),a=Math.max(0,parseInt(syInput.value||"0",10)),r=targetSelect.value;let i;meta.textContent="Rendering...";try{i=buildTiledCanvas(srcCanvas,e,t,n,a)}catch(e){return meta.textContent="Error building tiled canvas (possible out-of-memory or very large size).",void console.error(e)}sizeNote.textContent=`${i.width} x ${i.height} px (full)`;let o=[];o="all"===r?["full","1024","2048","4096","8192"]:[r],downloadsDiv.innerHTML="";const d=[];for(const r of o){let o;try{o=resizeToTarget(i,r)}catch(e){console.error("Error resizing to target",r,e);continue}const l=`tiled_${`${e}x${t}`+(n||a?`_sp${n}x${a}`:"")+`_${r}`}.png`,s=await makeDownloadLink(o,l);downloadsDiv.appendChild(s.el),d.push({target:r,canvas:o,link:s})}meta.textContent=`Rendered ${d.length} output(s). Click to save.`;const l=d.find(e=>"full"===e.target)||d[0];l&&drawPreview(l.canvas)}let renderTimer=null;function renderPreviewDebounced(){renderTimer&&clearTimeout(renderTimer),renderTimer=setTimeout(()=>{generateOutputs(),renderTimer=null},150)}function resizeToTarget(e,t){if("full"===t)return e;const n=parseInt(t,10);if(!n||n<=0)return e;const a=e.width,r=e.height,i=Math.max(a,r);if(i===n)return e;const o=n/i,d=Math.max(1,Math.round(a*o)),l=Math.max(1,Math.round(r*o)),s=createCanvas(d,l),c=s.getContext("2d");return c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(e,0,0,d,l),s}tilesInput.value="3",sxInput.value="0",syInput.value="0",fileInput.addEventListener("change",handleFileChange),tilesInput.addEventListener("input",renderPreviewDebounced),sxInput.addEventListener("input",renderPreviewDebounced),syInput.addEventListener("input",renderPreviewDebounced),targetSelect.addEventListener("change",renderPreviewDebounced),previewScaleSel.addEventListener("change",()=>{srcCanvas&&renderPreviewDebounced()}),gridCheckbox.addEventListener("change",()=>{srcCanvas&&renderPreviewDebounced()}),bordersCheckbox.addEventListener("change",()=>{srcCanvas&&renderPreviewDebounced()}),renderBtn.addEventListener("click",()=>{generateOutputs()}),downloadAllBtn.addEventListener("click",async()=>{const e=downloadsDiv.querySelectorAll("a.dl");e.length?e.forEach(e=>e.click()):meta.textContent="No outputs ready to download."}),clearBtn.addEventListener("click",()=>{srcCanvas=null,srcImage=null,fileInput.value="",downloadsDiv.innerHTML="",meta.textContent="Cleared.",previewCtx.clearRect(0,0,previewCanvas.width,previewCanvas.height),sizeNote.textContent=""})</script></body></html>