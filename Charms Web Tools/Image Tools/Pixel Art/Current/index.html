<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pixel Art Editor - Fixed Engines</title><style>:root{--bg-dark:#121212;--bg-panel:#1e1e1e;--bg-toolbar:#2d2d2d;--text-main:#e0e0e0;--accent:#bb86fc;--border:#333}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;margin:0;padding:0;display:flex;flex-direction:column;height:100vh;background:var(--bg-dark);color:var(--text-main);overflow:hidden}#toolbar{display:flex;justify-content:space-between;align-items:center;padding:8px 15px;background:var(--bg-toolbar);border-bottom:1px solid var(--border);z-index:10}#left-panel,#right-panel{width:240px;padding:15px;background:var(--bg-panel);border-right:1px solid var(--border);overflow-y:auto}#right-panel{border-right:none;border-left:1px solid var(--border)}#center{flex:1;display:flex;justify-content:center;align-items:center;overflow:auto;background:#0a0a0a;position:relative;padding:40px}#canvas{border:1px solid #444;image-rendering:pixelated;box-shadow:0 0 20px rgba(0,0,0,.5);max-width:90%;max-height:90%;object-fit:contain}#status-bar{padding:6px 15px;background:var(--bg-toolbar);border-top:1px solid var(--border);font-size:12px;color:#888}.control{margin-bottom:15px}label{display:block;margin-bottom:5px;font-size:13px;color:#aaa}button,input[type=number],select{background:#333;border:1px solid #444;color:#fff;padding:6px 12px;border-radius:4px}button:hover{background:var(--accent);color:#000;cursor:pointer}input[type=range]{width:100%;accent-color:var(--accent)}.zoom-controls button{margin-right:2px;padding:4px 10px;font-size:11px}</style></head><body><div id="toolbar"><div><input type="file" id="upload" accept="image/*" style="display:none"> <button onclick='document.getElementById("upload").click()'>Open Image</button> <button id="export">Export PNG</button></div><div><select id="backend"><option value="webgl2">WebGL2 Engine</option><option value="canvas2d">Canvas2D Engine</option></select></div></div><div style="display:flex;flex:1;overflow:hidden"><div id="left-panel"><div class="control"><label>Pixel Size: <span id="ps-val">8</span></label> <input type="range" id="pixel-size" min="1" max="128" value="8"></div><div class="control"><label><input type="checkbox" id="constrain-divisors"> Snap to Divisors</label></div><div class="control"><label>Sampling Mode:</label> <select id="mode" style="width:100%"><option value="hard">Hard (Nearest)</option><option value="box">Box (Average)</option></select></div><hr style="border:0;border-top:1px solid #333;margin:20px 0"><div class="control"><label>Colors: <span id="pal-val">256</span></label> <input type="range" id="palette-size" min="2" max="256" value="256"></div><div class="control" class="zoom-controls"><label>View Zoom:</label> <button data-zoom="0.5">50%</button> <button data-zoom="1">Fit Screen</button> <button data-zoom="2">200%</button></div></div><div id="center"><canvas id="canvas"></canvas></div><div id="right-panel"><h4 style="margin-top:0">Statistics</h4><div class="control"><label>Target Res:</label><div id="target-res-info" style="font-size:12px;color:var(--accent)">0 x 0</div></div><div class="control"><label>Engine Health:</label><div id="engine-health" style="font-size:12px">Stable</div></div></div></div><div id="status-bar">Engine: <span id="status-engine">Ready</span> | Original Res: <span id="status-res">0x0</span> | FPS: <span id="status-fps">0</span></div><script>let canvas,ctx,gl,srcTex,positionBuffer,texCoordBuffer,lowFBO,downscaleProgramHard,downscaleProgramBox,upscaleProgram,backend="webgl2",originalImage=null,originalW=0,originalH=0,pixelSize=8,constrainDivisors=!1,mode="hard",paletteSize=256,zoom=1,lastFrameTime=performance.now();const offCanvas=document.createElement("canvas"),offCtx=offCanvas.getContext("2d");function init(){canvas=document.getElementById("canvas"),setupEventListeners(),switchBackend()}function switchBackend(){backend=document.getElementById("backend").value;const e=canvas.cloneNode(!1);canvas.parentNode.replaceChild(e,canvas),canvas=e,gl=null,ctx=null,"webgl2"===backend?(gl=canvas.getContext("webgl2",{preserveDrawingBuffer:!0,antialias:!1}),gl?(initGL(),originalImage&&uploadTexture()):(backend="canvas2d",document.getElementById("backend").value="canvas2d",ctx=canvas.getContext("2d"))):ctx=canvas.getContext("2d"),originalW>0&&(canvas.width=originalW,canvas.height=originalH),render()}function uploadTexture(){gl&&originalImage&&(srcTex=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,srcTex),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,originalImage),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE))}function initGL(){const e="#version 300 es\n                in vec2 a_position; in vec2 a_texCoord;\n                out vec2 v_texCoord;\n                void main() { \n                    v_texCoord = a_texCoord; \n                    gl_Position = vec4(a_position, 0, 1); \n                }";downscaleProgramHard=createProgram(e,"#version 300 es\n                precision mediump float;\n                uniform sampler2D u_src; uniform vec2 u_lowSize;\n                in vec2 v_texCoord; out vec4 fragColor;\n                void main() { \n                    fragColor = texture(u_src, floor(v_texCoord * u_lowSize) / u_lowSize + 0.5/u_lowSize); \n                }"),downscaleProgramBox=createProgram(e,"#version 300 es\n                precision mediump float;\n                uniform sampler2D u_src; uniform vec2 u_srcSize; uniform vec2 u_lowSize;\n                in vec2 v_texCoord; out vec4 fragColor;\n                void main() {\n                    vec2 baseUV = (floor(v_texCoord * u_lowSize) + 0.5) / u_lowSize;\n                    vec2 step = 1.0 / u_srcSize;\n                    vec4 sum = vec4(0.0);\n                    for(int y=-1; y<=1; y++) for(int x=-1; x<=1; x++) \n                        sum += texture(u_src, baseUV + vec2(float(x), float(y)) * step);\n                    fragColor = sum / 9.0;\n                }"),upscaleProgram=createProgram(e,"#version 300 es\n                precision mediump float;\n                uniform sampler2D u_tex; \n                uniform bool u_flipY;\n                in vec2 v_texCoord; out vec4 fragColor;\n                void main() { \n                    vec2 uv = v_texCoord;\n                    if(u_flipY) uv.y = 1.0 - uv.y;\n                    fragColor = texture(u_tex, uv); \n                }"),positionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),gl.STATIC_DRAW),texCoordBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,texCoordBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,0,1,1,0,1]),gl.STATIC_DRAW)}function createProgram(e,t){const a=gl.createProgram(),n=compileShader(gl.VERTEX_SHADER,e),r=compileShader(gl.FRAGMENT_SHADER,t);return gl.attachShader(a,n),gl.attachShader(a,r),gl.linkProgram(a),a}function compileShader(e,t){const a=gl.createShader(e);return gl.shaderSource(a,t),gl.compileShader(a),gl.getShaderParameter(a,gl.COMPILE_STATUS)||console.error(gl.getShaderInfoLog(a)),a}function createFBO(e,t){const a=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,a);const n=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,n),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,t,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,n,0),{fbo:a,tex:n,w:e,h:t}}function render(e=!1){if(!originalImage)return;let t=pixelSize;if(constrainDivisors)for(;t>1&&(originalW%t!==0||originalH%t!==0);)t--;const a=Math.max(1,Math.ceil(originalW/t)),n=Math.max(1,Math.ceil(originalH/t));if("webgl2"===backend&&gl){lowFBO&&lowFBO.w===a&&lowFBO.h===n||(lowFBO=createFBO(a,n)),gl.bindFramebuffer(gl.FRAMEBUFFER,lowFBO.fbo),gl.viewport(0,0,a,n);const e="hard"===mode?downscaleProgramHard:downscaleProgramBox;gl.useProgram(e),gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);const t=gl.getAttribLocation(e,"a_position");gl.enableVertexAttribArray(t),gl.vertexAttribPointer(t,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,texCoordBuffer);const r=gl.getAttribLocation(e,"a_texCoord");gl.enableVertexAttribArray(r),gl.vertexAttribPointer(r,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,srcTex),gl.uniform1i(gl.getUniformLocation(e,"u_src"),0),gl.uniform2f(gl.getUniformLocation(e,"u_lowSize"),a,n),"box"===mode&&gl.uniform2f(gl.getUniformLocation(e,"u_srcSize"),originalW,originalH),gl.drawArrays(gl.TRIANGLES,0,6);const o=new Uint8Array(a*n*4);gl.readPixels(0,0,a,n,gl.RGBA,gl.UNSIGNED_BYTE,o),applyQuantization(o),gl.bindTexture(gl.TEXTURE_2D,lowFBO.tex),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,a,n,0,gl.RGBA,gl.UNSIGNED_BYTE,o),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,canvas.width,canvas.height),gl.useProgram(upscaleProgram),gl.uniform1i(gl.getUniformLocation(upscaleProgram,"u_flipY"),1),gl.bindTexture(gl.TEXTURE_2D,lowFBO.tex),gl.drawArrays(gl.TRIANGLES,0,6)}else if(ctx){ctx.clearRect(0,0,canvas.width,canvas.height),offCanvas.width=a,offCanvas.height=n,offCtx.imageSmoothingEnabled="box"===mode,offCtx.drawImage(originalImage,0,0,a,n);const e=offCtx.getImageData(0,0,a,n);applyQuantization(e.data),offCtx.putImageData(e,0,0),ctx.imageSmoothingEnabled=!1,ctx.drawImage(offCanvas,0,0,a,n,0,0,originalW,originalH)}updateStats(t,a,n)}function applyQuantization(e){if(paletteSize>=256)return;const t=256/paletteSize;for(let a=0;a<e.length;a+=4)for(let n=0;n<3;n++)e[a+n]=Math.floor(e[a+n]/t)*t}function updateStats(e,t,a){const n=performance.now(),r=(1e3/(n-lastFrameTime)).toFixed(1);lastFrameTime=n,document.getElementById("status-engine").textContent=backend.toUpperCase(),document.getElementById("status-res").textContent=`${originalW}x${originalH}`,document.getElementById("status-fps").textContent=r,document.getElementById("ps-val").textContent=e,document.getElementById("pal-val").textContent=paletteSize,document.getElementById("target-res-info").textContent=`${t} x ${a}`}function setupEventListeners(){document.getElementById("upload").addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const a=new Image;a.onload=()=>{originalImage=a,originalW=a.width,originalH=a.height,canvas.width=originalW,canvas.height=originalH,"webgl2"===backend&&uploadTexture(),render()},a.src=URL.createObjectURL(t)}),document.getElementById("pixel-size").addEventListener("input",e=>{pixelSize=parseInt(e.target.value),render()}),document.getElementById("palette-size").addEventListener("input",e=>{paletteSize=parseInt(e.target.value),render()}),document.getElementById("constrain-divisors").addEventListener("change",e=>{constrainDivisors=e.target.checked,render()}),document.getElementById("mode").addEventListener("change",e=>{mode=e.target.value,render()}),document.getElementById("backend").addEventListener("change",switchBackend),document.querySelectorAll("[data-zoom]").forEach(e=>{e.addEventListener("click",t=>{zoom=parseFloat(e.dataset.zoom),1===zoom?(canvas.style.transform="scale(1)",canvas.style.maxWidth="90%",canvas.style.maxHeight="90%"):(canvas.style.maxWidth="none",canvas.style.maxHeight="none",canvas.style.transform=`scale(${zoom})`)})}),document.getElementById("export").addEventListener("click",()=>{render(!0);const e=document.createElement("a");e.download=`pixelart_${originalW}x${originalH}.png`,e.href=canvas.toDataURL(),e.click()})}Math.clamp=(e,t,a)=>Math.max(t,Math.min(a,e)),window.onload=init</script></body></html>