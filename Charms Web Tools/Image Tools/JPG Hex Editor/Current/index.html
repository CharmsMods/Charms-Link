<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JPEG Byte Editor</title><style>:root{--bg:#121212;--panel:#1e1e1e;--text:#e0e0e0;--muted:#888;--accent:#4dabf7;--danger:#ff6b6b;--border:#333;--hover-bg:#2a2a2a;--mono:ui-monospace,SFMono-Regular,Menlo,Monaco,'Roboto Mono','Segoe UI Mono',monospace}body,html{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}.app{display:flex;flex-direction:column;gap:14px;padding:14px;height:100vh;width:100%;box-sizing:border-box;background:var(--bg);overflow:hidden}.top-row{display:grid;grid-template-columns:320px 1fr;gap:14px;flex:1;min-height:0;overflow:hidden}.preview-section{height:40vh;min-height:200px;max-height:50vh;display:flex;flex-direction:column}.controls-panel{overflow-y:auto}.panel{background:var(--panel);border-radius:10px;padding:16px;box-shadow:0 4px 6px rgba(0,0,0,.2);overflow:auto;color:var(--text);border:1px solid var(--border)}header{display:flex;gap:8px;align-items:center;margin-bottom:16px}h1{font-size:16px;margin:0;color:var(--text)}.small{font-size:12px;color:var(--muted)}input[type=file]{display:none}.controls{display:flex;flex-direction:column;gap:12px}.btn{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:6px;border:1px solid var(--border);cursor:pointer;background:#2a2a2a;color:var(--text);font-weight:500;transition:all .2s ease}.btn:hover{background:#333;border-color:#444}.btn.secondary{background:0 0;border:1px solid var(--border);font-weight:400}.meta{font-family:var(--mono);font-size:12px;color:var(--muted)}.segment-list{max-height:360px;overflow:auto;border-radius:6px;padding:6px;border:1px dashed var(--border);background:rgba(255,255,255,.03)}.seg{padding:8px;border-radius:6px;margin:4px 0;display:flex;justify-content:space-between;align-items:center;transition:background .2s ease}.seg:hover{background:var(--hover-bg)}.seg .m{font-weight:600;color:var(--text)}.seg .off{font-family:var(--mono);font-size:11px;color:var(--muted)}.editor{height:calc(100vh - 120px);display:flex;flex-direction:column}.hexview{flex:1;background:#1a1a1a;color:#e0e0e0;padding:12px;border-radius:8px;overflow:auto;font-family:var(--mono);font-size:12px;border:1px solid var(--border)}.hex-line{display:flex;gap:12px;align-items:flex-start;line-height:1.5}.offset{width:90px;color:#7fdbff;flex:0 0 90px;opacity:.8}.bytes{display:flex;flex-wrap:wrap;gap:6px}.byte{display:inline-block;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,.05);cursor:pointer;transition:all .15s ease}.byte:hover{background:rgba(255,255,255,.1)}.byte.editing{outline:2px solid var(--accent);background:rgba(77,171,247,.2)}.byte.highlight{background:rgba(255,213,0,.25)}.ascii{margin-left:12px;color:#b3b9c5;letter-spacing:1px}.controls-row{display:flex;gap:8px;align-items:center;margin-bottom:10px}.preview{display:flex;flex-direction:column;gap:12px;align-items:stretch}.img-wrap{position:relative;border-radius:8px;overflow:auto;border:1px solid var(--border);flex:1;min-height:100px;background:#141414;display:flex;align-items:center;justify-content:center}.img-wrap img{max-width:100%;max-height:100%;width:auto;height:auto;display:block;object-fit:contain;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges}.compare{position:relative;border-radius:8px;overflow:hidden;border:1px solid var(--border)}.compare img.top{position:absolute;left:0;top:0;height:100%;object-fit:contain}.compare .slider{position:absolute;left:0;top:0;bottom:0;width:50%;overflow:hidden;border-right:2px solid var(--accent)}footer{margin-top:12px;font-size:12px;color:var(--muted);padding-top:8px;border-top:1px solid var(--border)}.warn{color:var(--danger);font-weight:600}.muted{color:var(--muted)}input[type=number],input[type=range],select{padding:8px 10px;border-radius:6px;border:1px solid var(--border);background:#2a2a2a;color:var(--text);font-family:inherit;font-size:13px}input[type=number]:focus,select:focus{outline:0;border-color:var(--accent);box-shadow:0 0 0 2px rgba(77,171,247,.2)}select{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-image:url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");background-repeat:no-repeat;background-position:right 8px center;background-size:10px;padding-right:30px}.row{display:flex;gap:8px;align-items:center}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:4px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.25)}</style></head><body><div class="app"><div class="top-row"><div class="panel controls-panel"><header><h1>JPEG Byte Editor</h1></header><div class="controls"><label class="btn" style="margin-bottom:12px">Choose JPEG <input id="file" type="file" accept="image/jpeg"></label><div class="row"><button class="btn secondary" id="resetBtn">Reset edits</button></div><div class="meta panel-block"><div><strong id="fname">No file</strong></div><div class="small">Size: <span id="fsize">—</span> • Type: <span id="ftype">—</span></div></div><div><div style="display:flex;justify-content:space-between;align-items:center"><strong>JPEG segments</strong><span class="small">click to select</span></div><div class="segment-list" id="segments"></div></div><div><div style="display:flex;justify-content:space-between;align-items:center"><strong>Corruption tools</strong></div><div style="display:flex;gap:8px;margin-top:6px;align-items:center"><input id="corruptCount" type="number" value="10" min="1" style="width:80px"> bytes</div><div style="display:flex;gap:8px;margin-top:6px;align-items:center"><select id="corruptScope"><option value="all">Entire file</option><option value="selected">Selected segment</option></select> <button class="btn" id="corruptBtn">Corrupt</button></div><div style="display:flex;gap:8px;margin-top:6px;align-items:center"><button class="btn secondary" id="flipBits">Flip random bits</button> <button class="btn secondary" id="sanitizeBtn">Sanitize byte-stuffing</button></div></div><div><div style="display:flex;justify-content:space-between;align-items:center"><strong>Undo / History</strong></div><div style="display:flex;gap:8px;margin-top:6px"><button class="btn" id="undoBtn">Undo</button><button class="btn" id="snapshotBtn">Snapshot</button></div></div><div><div style="display:flex;justify-content:space-between;align-items:center"><strong>Download</strong></div><div style="display:flex;gap:8px;margin-top:6px"><button class="btn" id="downloadBtn">Download modified</button> <button class="btn secondary" id="downloadRawBtn">Download bytes.bin</button></div></div><div class="small muted">All processing happens locally in your browser. Use 'Reset edits' to revert to original file.</div></div></div><div class="panel editor"><div class="controls-row"><div class="small muted">Hex / Byte editor (double-click any byte to edit)</div><div style="margin-left:auto;display:flex;gap:8px;align-items:center"><label class="small muted">Bytes/line <input id="bytesPerLine" type="number" value="16" min="8" max="32" style="width:64px"></label> <button class="btn secondary" id="reflow">Reflow</button></div></div><div id="hexview" class="hexview" tabindex="0" aria-label="Hex byte viewer"></div></div></div><div class="preview-section"><div class="panel preview"><div style="display:flex;justify-content:space-between;align-items:center"><strong>Preview</strong><div class="small muted">Decode status: <span id="status">idle</span></div></div><div class="img-wrap"><img id="modImg" alt="Modified" style="width:100%;height:100%;object-fit:contain;display:block;background:#222"></div><div style="display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:8px"><button class="btn" id="refreshPreview">Refresh Preview</button></div><footer><div class="small muted">Notes: Editing entropy-coded sections may produce visual corruption or decode failure. 'Sanitize byte-stuffing' will insert 0x00 after any 0xFF inside entropy regions; this changes file length.</div></footer></div></div></div><script>const $=e=>document.getElementById(e);let originalBytes=null,bytes=null,history=[],segments=[],selectedSegmentIndex=-1,bytesPerLine=parseInt($("bytesPerLine").value,10)||16,currentBlobUrl=null;const markerNames={216:"SOI",217:"EOI",218:"SOS",224:"APP0",225:"APP1",254:"COM"};function markerName(e){return markerNames[e]?markerNames[e]:e>=224&&e<=239?"APP"+(e-224):e>=192&&e<=207?"SOF"+(e-192):e>=208&&e<=215?"RST"+(e-208):"0x"+e.toString(16).padStart(2,"0").toUpperCase()}function setStatus(e){$("status").textContent=e}async function loadFile(e){const t=await e.arrayBuffer();originalBytes=new Uint8Array(t),bytes=originalBytes.slice(),history=[],selectedSegmentIndex=-1,$("fname").textContent=e.name,$("fsize").textContent=originalBytes.length+" bytes",$("ftype").textContent=e.type||"image/jpeg",renderAll(),refreshPreview(),setStatus("loaded")}function renderAll(){parseSegments(),renderSegments(),renderHex(),refreshPreview()}function parseSegments(){if(segments=[],!bytes)return;const e=bytes.length;let t=0;for(e>=2&&255===bytes[0]&&216===bytes[1]&&(segments.push({marker:216,name:"SOI",offset:0,length:2,payloadOffset:null,payloadLength:0}),t=2);t<e;){if(255!==bytes[t]){const n=t;for(;t<e&&255!==bytes[t];)t++;segments.push({marker:null,name:"DATA",offset:n,length:t-n,payloadOffset:n,payloadLength:t-n});continue}if(t+1>=e)break;let n=t+1;for(;n<e&&255===bytes[n];)n++;if(n>=e)break;const s=bytes[n];if(0===s){t=n+1;continue}const r=s,a=markerName(r);if(216===r||217===r||r>=208&&r<=215||1===r){segments.push({marker:r,name:a,offset:t,length:2,payloadOffset:null,payloadLength:0}),t=n+1;continue}if(n+2>=e)break;const o=bytes[n+1]<<8|bytes[n+2],i=t,l=4,c=n+3,d=Math.max(0,o-2),f=l+d;if(segments.push({marker:r,name:a,offset:i,length:f,payloadOffset:c,payloadLength:d}),218===r){let n=i+f;for(;n<e-1;){if(255===bytes[n]){if(0===bytes[n+1]){n+=2;continue}break}n++}const s=i+f,r=Math.max(0,n-s);r>0&&segments.push({marker:238,name:"Entropy",offset:s,length:r,payloadOffset:s,payloadLength:r,relatedSOS:segments.length-1}),t=n}else t=i+f}}function renderSegments(){const e=$("segments");e.innerHTML="",segments.forEach((t,n)=>{const s=document.createElement("div");s.className="seg";const r=document.createElement("div");r.innerHTML=`<div class="m">${t.name}</div><div class="off">offset ${t.offset} • ${t.length} bytes</div>`;const a=document.createElement("div"),o=document.createElement("button");o.className="btn secondary",o.textContent="Select",o.addEventListener("click",()=>{selectSegment(n)}),a.appendChild(o),s.appendChild(r),s.appendChild(a),e.appendChild(s)})}function selectSegment(e){selectedSegmentIndex=e,renderHex(),setStatus("selected segment "+e+" ("+segments[e].name+")")}function renderHex(){const e=$("hexview");if(e.innerHTML="",!bytes)return;bytesPerLine=parseInt($("bytesPerLine").value,10)||16;const t=bytes.length;for(let n=0;n<t;n+=bytesPerLine){const s=document.createElement("div");s.className="hex-line";const r=document.createElement("div");r.className="offset",r.textContent=n.toString(16).padStart(8,"0");const a=document.createElement("div");a.className="bytes";const o=document.createElement("div");o.className="ascii";for(let e=0;e<bytesPerLine;e++){const s=n+e,r=document.createElement("span");if(r.className="byte",r.dataset.index=s,s<t){const e=bytes[s];r.textContent=e.toString(16).padStart(2,"0").toUpperCase();const t=e>=32&&e<127?String.fromCharCode(e):".";if(o.textContent+=t,selectedSegmentIndex>=0){const e=segments[selectedSegmentIndex];e&&s>=e.offset&&s<e.offset+e.length&&r.classList.add("highlight")}r.addEventListener("dblclick",onByteEdit)}else r.textContent="  ",o.textContent+=" ";a.appendChild(r)}s.appendChild(r),s.appendChild(a),s.appendChild(o),e.appendChild(s)}}function onByteEdit(e){const t=e.currentTarget,n=parseInt(t.dataset.index,10);if(isNaN(n)||n<0||n>=bytes.length)return;const s=bytes[n],r=document.createElement("input");function a(){const e=r.value.trim();if(/^[0-9a-fA-F]{1,2}$/.test(e)){const t=parseInt(e,16);pushHistory(),bytes[n]=t,renderHex(),refreshPreview(),setStatus("edited byte "+n)}else setStatus("invalid hex"),renderHex()}r.type="text",r.value=s.toString(16).padStart(2,"0").toUpperCase(),r.style.width="44px",r.style.fontFamily="var(--mono)",t.innerHTML="",t.appendChild(r),r.select(),r.addEventListener("blur",()=>{a()}),r.addEventListener("keydown",e=>{"Enter"===e.key?a():"Escape"===e.key&&(renderHex(),setStatus("edit canceled"))})}function pushHistory(){bytes&&(history.push(bytes.slice()),history.length>50&&history.shift())}function corruptRandom(e,t,n=0,s=e.length-1){for(let r=0;r<t;r++){e[Math.floor(Math.random()*(s-n+1))+n]=Math.floor(256*Math.random())}}function flipRandomBits(e){for(let t=0;t<e;t++){const e=Math.floor(Math.random()*bytes.length),t=1<<Math.floor(8*Math.random());bytes[e]=bytes[e]^t}}function sanitizeEntropy(){if(!segments||0===segments.length)return;let e=[];for(let t=0;t<bytes.length;t++)e.push(bytes[t]);let t=0;for(const n of segments)if("Entropy"===n.name){let s=n.offset+t,r=s+n.length,a=s;for(;a<r;)255===e[a]&&(a+1>=e.length||0!==e[a+1])?(e.splice(a+1,0,0),a+=2,r+=1,t+=1):a++}bytes=new Uint8Array(e),parseSegments()}function revokeCurrent(){currentBlobUrl&&(URL.revokeObjectURL(currentBlobUrl),currentBlobUrl=null)}function refreshPreview(){if(revokeCurrent(),bytes)try{const e=new Blob([bytes],{type:"image/jpeg"});currentBlobUrl=URL.createObjectURL(e),$("modImg").src=currentBlobUrl,setStatus("preview updated")}catch(e){setStatus("preview error: "+e.message)}}function scrollToOffset(e){const t=$("hexview"),n=22*Math.floor(e/bytesPerLine);t.scrollTop=n-40}function selectSegment(e){selectedSegmentIndex=e,renderHex();const t=segments[e];t&&scrollToOffset(t.offset)}$("file").addEventListener("change",function(e){const t=this.files[0];t&&loadFile(t)}),$("resetBtn").addEventListener("click",()=>{originalBytes&&(bytes=originalBytes.slice(),history=[],selectedSegmentIndex=-1,renderAll(),setStatus("reset to original"))}),$("undoBtn").addEventListener("click",()=>{0!==history.length&&(bytes=history.pop(),renderAll(),setStatus("undo"))}),$("snapshotBtn").addEventListener("click",()=>{pushHistory(),setStatus("snapshot saved")}),$("corruptBtn").addEventListener("click",()=>{const e=Math.max(1,parseInt($("corruptCount").value,10)||1),t=$("corruptScope").value;if(pushHistory(),"all"===t||selectedSegmentIndex<0)corruptRandom(bytes,e,0,bytes.length-1);else{const t=segments[selectedSegmentIndex];corruptRandom(bytes,e,t.offset,t.offset+t.length-1)}renderHex(),refreshPreview(),setStatus("corrupted "+e+" bytes")}),$("flipBits").addEventListener("click",()=>{pushHistory(),flipRandomBits(Math.max(1,parseInt($("corruptCount").value,10)||1)),renderHex(),refreshPreview(),setStatus("flipped bits")}),$("sanitizeBtn").addEventListener("click",()=>{pushHistory(),sanitizeEntropy(),renderAll(),setStatus("sanitized byte-stuffing (file length may change)")}),$("refreshPreview").addEventListener("click",()=>refreshPreview()),$("downloadBtn").addEventListener("click",()=>{if(!bytes)return;const e=new Blob([bytes],{type:"image/jpeg"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=($("fname").textContent||"image").replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_.-]/g,"")||"modified.jpg",document.body.appendChild(t),t.click(),setTimeout(()=>{t.remove(),URL.revokeObjectURL(t.href)},2e3)}),$("downloadRawBtn").addEventListener("click",()=>{if(!bytes)return;const e=new Blob([bytes.buffer],{type:"application/octet-stream"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="bytes.bin",t.click(),setTimeout(()=>{URL.revokeObjectURL(t.href)},2e3)}),$("reflow").addEventListener("click",()=>{renderHex(),setStatus("reflowed")}),setStatus("idle"),window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"z"===e.key.toLowerCase()&&(e.preventDefault(),$("undoBtn").click())})</script></body></html>