<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JPEG Byte Editor Pro</title><style>:root{--bg:#0f1115;--panel:#181b21;--panel-header:#22262e;--text:#e0e0e0;--text-muted:#9499a6;--accent:#3b82f6;--accent-hover:#2563eb;--danger:#ef4444;--success:#10b981;--border:#2e333d;--hover-bg:#2a2e35;--mono:'JetBrains Mono',ui-monospace,SFMono-Regular,Menlo,Monaco,'Roboto Mono',monospace;--font-ui:'Inter',system-ui,-apple-system,sans-serif}*{box-sizing:border-box;outline:0}body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font-ui);height:100vh;overflow:hidden;display:flex;flex-direction:column}.app{display:grid;grid-template-columns:300px 1fr 350px;grid-template-rows:100%;height:100%;width:100%}.panel{background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}.panel:last-child{border-right:none}.panel-header{padding:12px 16px;background:var(--panel-header);border-bottom:1px solid var(--border);font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text-muted);display:flex;justify-content:space-between;align-items:center}.panel-content{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:16px}h1{font-size:14px;margin:0;color:var(--text);font-weight:700}.small{font-size:11px;color:var(--text-muted)}.meta{font-family:var(--mono);font-size:11px;color:var(--text-muted);background:rgba(0,0,0,.2);padding:8px;border-radius:4px}input[type=file]{display:none}.btn{display:inline-flex;justify-content:center;align-items:center;gap:6px;padding:8px 12px;border-radius:6px;border:1px solid var(--border);cursor:pointer;background:#2a2e35;color:var(--text);font-size:12px;font-weight:500;transition:all .15s ease;width:100%}.btn:hover:not(:disabled){background:var(--hover-bg);border-color:#4a4e55}.btn:active:not(:disabled){transform:translateY(1px)}.btn:disabled{opacity:.5;cursor:not-allowed}.btn-primary{background:var(--accent);border-color:var(--accent);color:#fff}.btn-primary:hover:not(:disabled){background:var(--accent-hover)}.btn-danger{color:var(--danger);border-color:rgba(239,68,68,.3);background:rgba(239,68,68,.1)}.btn-danger:hover{background:rgba(239,68,68,.2)}.row{display:flex;gap:8px}.col{display:flex;flex-direction:column;gap:8px}input[type=number],input[type=text],select{width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:#0f1115;color:var(--text);font-family:var(--mono);font-size:12px}input:focus,select:focus{border-color:var(--accent)}.segment-list{border:1px solid var(--border);border-radius:6px;background:rgba(0,0,0,.2);max-height:300px;overflow-y:auto}.seg{padding:8px 12px;border-bottom:1px solid var(--border);cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-size:12px}.seg:last-child{border-bottom:none}.seg:hover{background:var(--hover-bg)}.seg.active{background:rgba(59,130,246,.15);border-left:3px solid var(--accent)}.seg-name{font-weight:600;font-family:var(--mono)}.seg-off{color:var(--text-muted);font-size:11px}.hex-toolbar{padding:8px 16px;background:var(--panel-header);border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center}.hexview-container{flex:1;overflow:auto;position:relative;background:#121418;cursor:default}.hexview{padding:16px;font-family:var(--mono);font-size:12px;line-height:1.6;user-select:text}.hex-line{display:flex;white-space:pre}.offset{color:var(--text-muted);margin-right:16px;width:80px;flex-shrink:0;display:inline-block}.bytes{display:inline-block;margin-right:16px;color:#cdd6f4}.ascii{color:#7f849c}.byte{color:inherit;cursor:pointer;padding:1px 2px;border-radius:2px;transition:background .1s}.byte:hover{background:rgba(255,255,255,.1);color:#fff}.byte.highlight{background:rgba(59,130,246,.3);color:#fff}.byte.editing{background:var(--accent);color:#fff;box-shadow:0 0 0 2px var(--accent-hover)}.byte.search-match{background:rgba(234,179,8,.4);color:#fff}.byte-input{background:0 0;border:none;color:#fff;font-family:inherit;font-size:inherit;width:24px;text-transform:uppercase;padding:0;margin:0}.img-container{flex:1;background:linear-gradient(45deg,#1a1d23 25%,transparent 25%),linear-gradient(-45deg,#1a1d23 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#1a1d23 75%),linear-gradient(-45deg,transparent 75%,#1a1d23 75%);background-size:20px 20px;background-position:0 0,0 10px,10px -10px,-10px 0;display:flex;align-items:center;justify-content:center;border:1px solid var(--border);border-radius:6px;overflow:hidden;position:relative;min-height:200px}.img-container img{max-width:100%;max-height:100%;object-fit:contain;display:block}.img-error{color:var(--danger);text-align:center;padding:20px;font-family:var(--mono);font-size:12px}.divider{height:1px;background:var(--border);margin:4px 0}.label{font-size:11px;color:var(--text-muted);font-weight:600;margin-bottom:4px}::-webkit-scrollbar{width:10px;height:10px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:#333;border-radius:5px;border:2px solid var(--bg)}::-webkit-scrollbar-thumb:hover{background:#444}.toast-container{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:1000;pointer-events:none}.toast{background:var(--panel);color:var(--text);padding:10px 16px;border-radius:6px;border-left:4px solid var(--accent);box-shadow:0 5px 15px rgba(0,0,0,.3);font-size:13px;opacity:0;transform:translateY(20px);transition:all .3s ease;pointer-events:auto;max-width:300px}.toast.show{opacity:1;transform:translateY(0)}.toast.success{border-color:var(--success)}.toast.error{border-color:var(--danger)}@media (max-width:1024px){.app{grid-template-columns:260px 1fr}.preview-section{display:none}.preview-section.mobile-visible{display:flex;position:fixed;inset:0;z-index:50;background:var(--bg)}}@media (max-width:768px){.app{display:flex;flex-direction:column;height:auto;overflow:auto}body{overflow:auto}.panel{height:auto;border-right:none;border-bottom:1px solid var(--border)}.hexview-container{height:500px}.preview-section{display:flex;height:auto}}</style></head><body><div class="app"><aside class="panel"><div class="panel-header"><span>Controls</span></div><div class="panel-content"><div class="col"><label class="btn btn-primary">Load JPEG <input id="file" type="file" accept="image/jpeg"></label><div class="meta" id="fileInfo">No file loaded</div></div><div class="divider"></div><div><div class="label">Segments</div><div class="segment-list" id="segments"><div class="seg" style="justify-content:center;color:var(--text-muted)">Load a file to parse</div></div></div><div class="divider"></div><div><div class="label">Corruption Tools</div><div class="row"><input type="number" id="corruptCount" value="10" min="1" max="1000" title="Count"> <select id="corruptScope" style="flex:1"><option value="all">Entire File</option><option value="selected">Selected Segment</option></select></div><div class="row" style="margin-top:8px"><button class="btn btn-danger" id="corruptBtn">Corrupt Bytes</button> <button class="btn" id="flipBitsBtn">Flip Bits</button></div></div><div class="divider"></div><div><div class="label">Repair & Utils</div><button class="btn" id="sanitizeBtn">Sanitize Byte-Stuffing</button> <button class="btn" id="resetBtn" style="margin-top:8px">Reset All Edits</button></div><div style="flex:1"></div><div><div class="label">History</div><div class="row"><button class="btn" id="undoBtn">Undo (Ctrl+Z)</button> <button class="btn" id="redoBtn" disabled="disabled">Redo (Ctrl+Y)</button></div></div><div class="row"><button class="btn" id="dlBtn">Download .jpg</button> <button class="btn" id="dlRawBtn">Download .bin</button></div></div></aside><main class="panel"><div class="panel-header"><span>Hex Editor</span> <span class="small" id="editStatus">Read Only</span></div><div class="hex-toolbar"><input type="text" id="searchInput" placeholder="Find Hex (FF D8)..." style="width:150px"> <button class="btn" id="searchBtn" style="width:auto">Find</button><div style="width:1px;height:16px;background:var(--border);margin:0 4px"></div><div class="row" style="flex:1;justify-content:flex-end"><span class="small" style="margin-right:4px">Goto:</span> <input type="text" id="gotoInput" placeholder="0x0" style="width:80px"> <button class="btn" id="gotoBtn" style="width:auto">Go</button></div></div><div class="hexview-container" id="hexScrollContainer"><div id="hexview" class="hexview" tabindex="0"></div></div></main><aside class="panel preview-section"><div class="panel-header"><span>Visual Preview</span> <button class="btn" id="refreshPreviewBtn" style="width:auto;padding:2px 8px;font-size:10px">Refresh</button></div><div class="panel-content"><div class="img-container"><img id="previewImg" alt="Preview" style="display:none"><div id="previewPlaceholder" class="img-error" style="color:var(--text-muted);display:flex;align-items:center;justify-content:center;height:100%">No Image</div></div><div class="meta" style="font-size:11px;line-height:1.4"><strong>Note:</strong> Browsers attempt to recover from corrupt JPEGs. If the image is blank, the file structure is critically damaged.</div></div></aside></div><div class="toast-container" id="toastContainer"></div><script>const State={originalBytes:null,bytes:null,history:[],redoStack:[],segments:[],selectedSegmentIndex:-1,selection:{start:-1,end:-1},searchResults:[],searchIndex:0},$=e=>document.getElementById(e),els={file:$("file"),fileInfo:$("fileInfo"),segments:$("segments"),hexview:$("hexview"),hexContainer:$("hexScrollContainer"),previewImg:$("previewImg"),previewPlaceholder:$("previewPlaceholder"),corruptCount:$("corruptCount"),corruptScope:$("corruptScope"),undoBtn:$("undoBtn"),redoBtn:$("redoBtn"),searchInput:$("searchInput"),gotoInput:$("gotoInput"),status:$("editStatus")};async function handleFileSelect(e){const t=e.target.files[0];if(t)try{const e=await t.arrayBuffer();State.originalBytes=new Uint8Array(e),State.bytes=new Uint8Array(e),State.history=[],State.redoStack=[],State.selection={start:-1,end:-1},els.fileInfo.textContent=`${t.name} (${formatBytes(t.length)})`,parseSegments(),renderSegments(),renderHex(),refreshPreview(),updateUndoUI(),showToast("File loaded successfully","success")}catch(e){showToast("Error loading file: "+e.message,"error")}}function resetFile(){State.originalBytes&&(pushHistory(),State.bytes=State.originalBytes.slice(),State.redoStack=[],renderAll(),showToast("Reset to original file"))}function renderAll(){parseSegments(),renderSegments(),renderHex(),refreshPreview(),updateUndoUI()}function parseSegments(){State.segments=[];const e=State.bytes;if(!e)return;const t=e.length;let s=0;for(t>=2&&255===e[0]&&216===e[1]&&(State.segments.push({marker:216,name:"SOI (Start)",offset:0,length:2}),s=2);s<t;){if(255!==e[s]){let n=s;for(;s<t&&255!==e[s];)s++;s-n>0&&State.segments.push({marker:0,name:"Data / Entropy",offset:n,length:s-n});continue}for(;s<t&&255===e[s];)s++;if(s>=t)break;const n=e[s],r=getMarkerName(n);if([216,217,0,1].includes(n)||n>=208&&n<=215){State.segments.push({marker:n,name:r,offset:s-1,length:2}),s++;continue}if(s+2>t)break;const a=(e[s+1]<<8|e[s+2])+2;State.segments.push({marker:n,name:r,offset:s-1,length:a}),s+=a}}function getMarkerName(e){const t={216:"SOI",217:"EOI",218:"SOS (Start Scan)",224:"APP0 (JFIF)",225:"APP1 (EXIF)",254:"COM (Comment)",219:"DQT (Quant Table)",196:"DHT (Huffman Table)"};return t[e]?t[e]:e>=224&&e<=239?"APP"+(e-224):e>=192&&e<=207?"SOF"+(e-192):e>=208&&e<=215?"RST"+(e-208):`0x${e.toString(16).toUpperCase()}`}function renderSegments(){els.segments.innerHTML="",State.segments.forEach((e,t)=>{const s=document.createElement("div");s.className="seg "+(t===State.selectedSegmentIndex?"active":""),s.innerHTML=`\n        <span class="seg-name">${e.name}</span>\n        <span class="seg-off">${e.offset} - ${e.offset+e.length}</span>\n      `,s.addEventListener("click",()=>selectSegment(t)),els.segments.appendChild(s)})}function selectSegment(e){State.selectedSegmentIndex=e,renderSegments();const t=State.segments[e];t&&(scrollToOffset(t.offset),highlightRange(t.offset,t.offset+t.length))}function renderHex(){if(els.hexview.innerHTML="",!State.bytes)return;const e=document.createDocumentFragment(),t=State.bytes;for(let s=0;s<t.length;s+=16){const n=document.createElement("div");n.className="hex-line";const r=document.createElement("span");r.className="offset",r.textContent=s.toString(16).padStart(8,"0").toUpperCase(),n.appendChild(r);const a=document.createElement("span");a.className="bytes";const o=document.createElement("span");o.className="ascii";for(let e=0;e<16;e++){const n=s+e;if(n<t.length){const e=t[n],s=document.createElement("span");s.className="byte",s.textContent=e.toString(16).padStart(2,"0").toUpperCase(),s.dataset.idx=n,isHighlighted(n)&&s.classList.add("highlight"),isSearchMatch(n)&&s.classList.add("search-match"),s.addEventListener("dblclick",e=>editByte(e,n)),a.appendChild(s),o.textContent+=e>=32&&e<127?String.fromCharCode(e):"."}else a.appendChild(document.createTextNode("   "))}n.appendChild(a),n.appendChild(o),e.appendChild(n)}els.hexview.appendChild(e)}function isHighlighted(e){if(-1===State.selection.start)return!1;if(-1!==State.selectedSegmentIndex){const t=State.segments[State.selectedSegmentIndex];if(t&&e>=t.offset&&e<t.offset+t.length)return!0}return!1}function isSearchMatch(e){return State.searchResults.some(t=>e>=t&&e<t+State.searchResults.length)}function highlightRange(e,t){State.selection={start:e,end:t},renderHex()}function editByte(e,t){const s=e.target,n=State.bytes[t];s.classList.add("editing"),s.innerHTML=`<input type="text" class="byte-input" value="${n.toString(16).padStart(2,"0")}" maxlength="2">`;const r=s.querySelector("input");r.focus(),r.select();r.addEventListener("blur",()=>{const e=parseInt(r.value,16);!isNaN(e)&&e>=0&&e<=255&&e!==n&&(pushHistory(),State.bytes[t]=e,showToast(`Edited byte at 0x${t.toString(16)}: 0x${n.toString(16)} -> 0x${e.toString(16)}`),refreshPreview()),renderHex()}),r.addEventListener("keydown",e=>{"Enter"===e.key?r.blur():"Escape"===e.key&&renderHex()})}function corruptBytes(){if(!State.bytes)return;pushHistory();let e=0,t=State.bytes.length;const s=els.corruptScope.value;if("selected"===s&&-1!==State.selectedSegmentIndex){const s=State.segments[State.selectedSegmentIndex];e=s.offset,t=s.offset+s.length}const n=parseInt(els.corruptCount.value)||10;for(let s=0;s<n;s++){const s=Math.floor(Math.random()*(t-e))+e;State.bytes[s]=Math.floor(256*Math.random())}renderHex(),refreshPreview(),showToast(`Corrupted ${n} bytes in ${"selected"===s?"segment":"file"}`,"error")}function flipBits(){if(!State.bytes)return;pushHistory();const e=parseInt(els.corruptCount.value)||10;for(let t=0;t<e;t++){const e=Math.floor(Math.random()*State.bytes.length),t=1<<Math.floor(8*Math.random());State.bytes[e]^=t}renderHex(),refreshPreview(),showToast(`Flipped random bits in ${e} locations`)}function sanitizeEntropy(){if(!State.bytes)return;pushHistory();const e=State.bytes,t=[];for(let s=0;s<e.length;s++){const n=e[s];if(t.push(n),255===n&&s+1<e.length){0!==e[s+1]&&t.push(0)}}State.bytes=new Uint8Array(t),renderAll(),showToast("Sanitized byte-stuffing (inserted 00s after FF)","success")}function pushHistory(){State.history.push(State.bytes.slice()),State.history.length>10&&State.history.shift(),State.redoStack=[],updateUndoUI()}function undo(){0!==State.history.length&&(State.redoStack.push(State.bytes.slice()),State.bytes=State.history.pop(),renderAll(),showToast("Undo"))}function redo(){0!==State.redoStack.length&&(State.history.push(State.bytes.slice()),State.bytes=State.redoStack.pop(),renderAll(),showToast("Redo"))}function updateUndoUI(){els.undoBtn.disabled=0===State.history.length,els.redoBtn.disabled=0===State.redoStack.length,els.status.textContent=State.history.length>0?"Modified":"Original"}function refreshPreview(){if(State.bytes)try{const e=new Blob([State.bytes],{type:"image/jpeg"}),t=URL.createObjectURL(e);els.previewImg.src=t,els.previewImg.dataset.currentUrl&&URL.revokeObjectURL(els.previewImg.dataset.currentUrl),els.previewImg.dataset.currentUrl=t}catch(e){showToast("Preview generation failed","error")}}function download(e,t){if(!State.bytes)return;const s=new Blob([State.bytes],{type:e}),n=document.createElement("a");n.href=URL.createObjectURL(s),n.download=t,n.click()}function formatBytes(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]}function scrollToOffset(e){const t=Math.floor(e/16);els.hexContainer.scrollTop=20*t-50}function gotoOffset(){const e=els.gotoInput.value;let t=parseInt(e,16);isNaN(t)&&(t=parseInt(e,10)),!isNaN(t)&&t>=0&&t<State.bytes.length?(scrollToOffset(t),highlightRange(t,t+1),setTimeout(()=>renderHex(),500)):showToast("Invalid offset","error")}function searchBytes(e=!1){const t=els.searchInput.value.replace(/\s+/g,"");if(!t||!State.bytes)return;const s=[];for(let e=0;e<t.length;e+=2)s.push(parseInt(t.substr(e,2),16));if(0!==s.length){if(!e){State.searchIndex=0,State.searchResults=[];const e=State.bytes,t=s;for(let s=0;s<e.length-t.length+1;s++){let n=!0;for(let r=0;r<t.length;r++)if(e[s+r]!==t[r]){n=!1;break}n&&State.searchResults.push(s)}showToast(`Found ${State.searchResults.length} matches`)}if(State.searchResults.length>0){const e=State.searchResults[State.searchIndex];scrollToOffset(e);document.querySelectorAll(".byte").forEach(e=>e.classList.remove("search-match"));const t=document.querySelector(`.byte[data-idx="${e}"]`);t&&t.scrollIntoView({block:"center",behavior:"smooth"}),State.searchIndex=(State.searchIndex+1)%State.searchResults.length}else showToast("No matches found","error")}}function showToast(e,t="info"){const s=$("toastContainer"),n=document.createElement("div");n.className=`toast ${t}`,n.textContent=e,s.appendChild(n),n.offsetWidth,n.classList.add("show"),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),300)},3e3)}els.file.addEventListener("change",handleFileSelect),els.undoBtn.addEventListener("click",undo),els.redoBtn.addEventListener("click",redo),$("resetBtn").addEventListener("click",resetFile),$("corruptBtn").addEventListener("click",corruptBytes),$("flipBitsBtn").addEventListener("click",flipBits),$("sanitizeBtn").addEventListener("click",sanitizeEntropy),$("dlBtn").addEventListener("click",()=>download("image/jpeg","modified.jpg")),$("dlRawBtn").addEventListener("click",()=>download("application/octet-stream","dump.bin")),$("searchBtn").addEventListener("click",searchBytes),$("gotoBtn").addEventListener("click",gotoOffset),$("refreshPreviewBtn").addEventListener("click",refreshPreview),els.previewImg.addEventListener("error",()=>{els.previewImg.style.display="none",els.previewPlaceholder.style.display="flex",els.previewPlaceholder.textContent="Decode Error (Corrupt Header/Data)"}),els.previewImg.addEventListener("load",()=>{els.previewImg.style.display="block",els.previewPlaceholder.style.display="none"}),window.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"z"===e.key.toLowerCase()&&(e.preventDefault(),undo()),(e.ctrlKey||e.metaKey)&&"y"===e.key.toLowerCase()&&(e.preventDefault(),redo()),"F3"===e.key&&(e.preventDefault(),searchBytes(!0))})</script></body></html>
