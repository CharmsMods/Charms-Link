(function(){"use strict";self.onmessage=function(g){const{data:r,count:u}=g.data,l={};for(let t=0;t<r.length;t+=4){if(r[t+3]<128)continue;const e=r[t],o=r[t+1],s=r[t+2],p="#"+((1<<24)+(e<<16)+(o<<8)+s).toString(16).slice(1).toUpperCase();l[p]=(l[p]||0)+1}const n=Object.entries(l).map(([t,e])=>({hex:t,freq:e,r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16)}));if(n.length===0){postMessage({palette:[]});return}const a=[];n.sort((t,e)=>e.freq-t.freq),a.push(n[0]);const i=new Float32Array(n.length).fill(1e10),c=t=>{for(let e=0;e<n.length;e++){const o=n[e],s=Math.sqrt(Math.pow(o.r-t.r,2)+Math.pow(o.g-t.g,2)+Math.pow(o.b-t.b,2));s<i[e]&&(i[e]=s)}};c(a[0]);const f=Math.min(u,n.length);for(;a.length<f;){let t=-1,e=-1;for(let s=0;s<n.length;s++)i[s]>e&&(e=i[s],t=s);if(t===-1)break;const o=n[t];a.push(o),c(o)}postMessage({palette:a.map(t=>t.hex)})}})();
