<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Image Color Fader</title><script src="https://cdn.tailwindcss.com"></script><style>*{box-sizing:border-box}body{font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background-color:#000!important;color:#fff!important;min-height:100vh}.canvas-container{background:#000;border-radius:.75rem;padding:1rem;border:2px solid #fff}canvas{background-color:#fff;max-width:100%;max-height:75vh;width:auto;height:auto;display:block;border-radius:.5rem;box-shadow:0 10px 25px rgba(255,255,255,.1);border:1px solid #fff;margin:0 auto}input[type=file]{display:none}.custom-file-upload{display:inline-flex;align-items:center;padding:.75rem 1.5rem;background:#666;color:#fff;border:2px solid #999;border-radius:.5rem;font-weight:600;cursor:pointer;transition:all .3s ease;text-decoration:none;font-size:.875rem}.custom-file-upload:hover{background:#555;border-color:#888;transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,255,255,.3)}.action-btn{padding:.5rem 1rem;border:none;border-radius:.5rem;font-weight:600;font-size:.875rem;cursor:pointer;transition:all .3s ease;color:#fff}.action-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,255,255,.3)}.bg-gray-600{background-color:#666}.hover\:bg-gray-700:hover{background-color:#555}.control-section{margin-bottom:.5rem}.control-section:last-child{margin-bottom:0}.control-title{font-size:.875rem;font-weight:600;color:#fff;margin-bottom:.75rem;text-transform:uppercase;letter-spacing:.05em}.toggle-container{display:flex;align-items:center;cursor:pointer;user-select:none}.toggle-input{appearance:none;width:2.5rem;height:1.25rem;background-color:#000;border-radius:.625rem;position:relative;cursor:pointer;transition:background-color .3s ease;margin-right:.75rem;border:2px solid #fff}.toggle-input:checked{background-color:#ccc;border-color:#999}.toggle-input.disabled{background-color:#000;border-color:#fff;cursor:not-allowed;opacity:.3}.toggle-input.disabled:checked{background-color:#000;border-color:#fff}.toggle-container.disabled{cursor:not-allowed;opacity:.5}.toggle-input::before{content:'';position:absolute;width:.875rem;height:.875rem;border-radius:50%;background-color:#fff;top:50%;left:.125rem;transform:translateY(-50%);transition:transform .3s ease;box-shadow:0 2px 4px rgba(0,0,0,.2)}.toggle-input:checked::before{transform:translateY(-50%) translateX(1.25rem)}.toggle-input.disabled::before{background-color:#fff;opacity:.5}.toggle-label{font-size:.875rem;color:#fff;font-weight:500}.slider-container{margin-top:.5rem}.custom-slider{width:100%;height:.375rem;border-radius:.1875rem;background:#fff;outline:0;appearance:none;cursor:pointer;transition:background .3s ease}.custom-slider::-webkit-slider-thumb{appearance:none;width:1.25rem;height:1.25rem;border-radius:50%;background:#ccc;cursor:pointer;border:2px solid #000;box-shadow:0 2px 6px rgba(255,255,255,.3);transition:all .3s ease}.custom-slider::-webkit-slider-thumb:hover{transform:scale(1.1);box-shadow:0 4px 12px rgba(255,255,255,.5)}.custom-slider::-moz-range-thumb{width:1.25rem;height:1.25rem;border-radius:50%;background:#ccc;cursor:pointer;border:2px solid #000;box-shadow:0 2px 6px rgba(255,255,255,.3)}.color-picker{width:2.5rem;height:2rem;border:2px solid #fff;border-radius:.375rem;cursor:pointer;background:0 0;transition:border-color .3s ease}.color-picker:hover{border-color:#ccc}.copy-btn{padding:.25rem .5rem;background:#000;color:#ccc;border:1px solid #fff;border-radius:.25rem;font-size:.75rem;font-weight:500;cursor:pointer;transition:all .3s ease}.copy-btn:hover{background:#fff;border-color:#ccc;color:#000}#message-box{backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}#message-box.bg-green-100{background:rgba(255,255,255,.1);border-color:#fff;color:#fff}#message-box.bg-red-100{background:rgba(0,0,0,.1);border-color:#fff;color:#fff}#message-box.bg-blue-100{background:rgba(128,128,128,.1);border-color:#fff;color:#fff}@media (max-width:1280px){.canvas-container{margin-bottom:2rem}}@media (max-width:640px){.custom-file-upload{width:100%;justify-content:center;margin-bottom:1rem}.action-btn{flex:1}}.accordion-content{overflow:hidden;transition:max-height .3s ease;max-height:0}.accordion.active .accordion-content{max-height:1000px}.shape-controls{overflow:hidden;transition:max-height .3s ease;max-height:0}.shape-controls.active{max-height:2000px}.arrow{transition:transform .3s ease}.accordion.active .arrow{transform:rotate(180deg)}</style></head><body class="min-h-screen"><div id="message-box" class="fixed top-4 left-4 z-50 hidden p-4 text-sm rounded-lg shadow-lg max-w-sm" role="alert"><span class="font-medium" id="message-text"></span></div><div id="performance-warning" class="fixed top-4 right-4 z-50 hidden p-4 text-sm rounded-lg shadow-lg max-w-sm bg-gray-800 border border-gray-600 text-gray-200" role="alert"><div class="flex items-start"><div class="flex-shrink-0"><svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><h3 class="text-sm font-medium">Performance Mode</h3><p class="mt-1 text-xs">Real-time preview disabled due to slow processing. Use the Preview button to see changes, or re-enable real-time mode if desired.</p><button id="dismiss-warning" class="mt-2 text-xs text-gray-400 hover:text-gray-300 underline">Dismiss</button></div></div></div><header class="bg-black border-b border-white py-6"><div class="container mx-auto px-6"><h1 class="text-3xl font-bold text-center text-white"></h1></div></header><div class="container mx-auto px-6 py-8 max-w-7xl"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-black rounded-lg p-6 border border-white"><div class="flex flex-col sm:flex-row items-center justify-between mb-6 gap-4"><label for="imageUpload" class="custom-file-upload">Upload Image</label> <input type="file" id="imageUpload" accept="image/*"><div class="flex gap-3 flex-wrap"><button id="previewButton" class="action-btn bg-gray-600 hover:bg-gray-700 hidden">Preview</button> <button id="resetButton" class="action-btn bg-gray-600 hover:bg-gray-700">Reset</button> <button id="applyButton" class="action-btn bg-gray-600 hover:bg-gray-700">Apply</button> <button id="downloadButton" class="action-btn bg-gray-600 hover:bg-gray-700">Download</button></div></div><div class="canvas-container"><canvas id="imageCanvas" class="w-full h-auto"></canvas></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-black rounded-lg p-6 border border-white"><h2 class="text-xl font-semibold text-white mb-6">Color Tools</h2><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Preview <span class="arrow">▼</span></h3><div class="accordion-content"><label class="toggle-container"><input type="checkbox" id="realtimePreviewToggle" class="toggle-input" checked="checked"> <span class="toggle-label">Real-time Preview</span></label><p class="text-xs text-white opacity-70 mt-2">Updates preview as you adjust settings</p></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Selected Color <span class="arrow">▼</span></h3><div class="accordion-content"><div class="flex items-center space-x-3 mb-3"><div id="colorSwatch" class="w-12 h-12 border-2 border-white rounded-lg shadow-sm" style="background-color:#fff"></div><div class="flex-1"><div class="flex items-center justify-between mb-1"><span class="text-sm text-white">Hex: <span id="hexDisplay" class="text-white font-mono">#FFFFFF</span></span> <button id="copyHexButton" class="copy-btn" title="Copy hex value">Copy</button></div><div class="flex items-center justify-between"><span class="text-sm text-white">RGB: <span id="rgbDisplay" class="text-white font-mono">rgb(255, 255, 255)</span></span> <button id="copyRgbButton" class="copy-btn" title="Copy RGB value">Copy</button></div><div class="mt-2"><span class="text-sm text-white">Resolution: <span id="resolutionDisplay" class="text-white font-mono">No image</span></span></div></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Selection Mode <span class="arrow">▼</span></h3><div class="accordion-content"><div class="space-y-3"><label class="toggle-container"><input type="checkbox" id="areaSelectionToggle" class="toggle-input"> <span class="toggle-label">Area Selection (Flood Fill)</span></label><p class="text-xs text-white opacity-70 mt-2">Target only the connected area you click on.</p></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Mode <span class="arrow">▼</span></h3><div class="accordion-content"><div class="space-y-3"><label class="toggle-container"><input type="checkbox" id="colorReplacementToggle" class="toggle-input"> <span class="toggle-label">Replace with Color</span></label><div id="colorPickerContainer" class="hidden pl-6"><div class="flex items-center space-x-3"><input type="color" id="replacementColorPicker" value="#ff0000" class="color-picker"> <span class="text-sm text-white">Color: <span id="replacementColorDisplay" class="text-white font-mono">#FF0000</span></span></div></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Opacity <span class="arrow">▼</span></h3><div class="accordion-content"><div class="slider-container"><input type="range" id="opacitySlider" min="0" max="1" step="0.01" value="0" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>0%</span> <span>100%</span></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Tolerance <span class="arrow">▼</span></h3><div class="accordion-content"><label class="toggle-container"><input type="checkbox" id="toleranceToggle" class="toggle-input" checked="checked"> <span class="toggle-label">Enable Tolerance Mode</span></label><div id="toleranceSliderContainer" class="mt-3 pl-6"><div class="slider-container"><label class="text-sm text-white mb-2 block">Strength</label> <input type="range" id="toleranceStrengthSlider" min="0" max="100" step="1" value="20" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>Low</span> <span>High</span></div></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Selection <span class="arrow">▼</span></h3><div class="accordion-content"><label class="toggle-container"><input type="checkbox" id="invertSelectionToggle" class="toggle-input"> <span class="toggle-label">Invert Selection</span></label><p class="text-xs text-white opacity-70 mt-2">Applies effect to all colors EXCEPT the selection.</p></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Edge Smoothing <span class="arrow">▼</span></h3><div class="accordion-content"><label class="toggle-container"><input type="checkbox" id="antiAliasingToggle" class="toggle-input" checked="checked"> <span class="toggle-label">Enable Edge Smoothing</span></label><div id="smoothingSliderContainer" class="mt-3 pl-6"><div class="slider-container"><label class="text-sm text-white mb-2 block">Factor</label> <input type="range" id="smoothingFactorSlider" min="0.1" max="1.0" step="0.05" value="1.0" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>Sharp</span> <span>Smooth</span></div></div></div></div></div></div><div class="bg-black rounded-lg p-6 border border-white"><h2 class="text-xl font-semibold text-white mb-6">Shape Tools</h2><label class="toggle-container mb-4"><input type="checkbox" id="shapeModeToggle" class="toggle-input"> <span class="toggle-label">Enable Shape Replace Mode</span></label><p class="text-xs text-white opacity-70 mt-2 mb-4">Replace or erase parts of the image with a shape. In this mode, clicks pick replacement color.</p><div id="shapeControls" class="shape-controls"><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Shape Type <span class="arrow">▼</span></h3><div class="accordion-content"><select id="shapeTypeSelect" class="bg-black border border-white text-white p-2 rounded-lg w-full"><option value="rectangle">Rectangle</option><option value="ellipse">Ellipse</option></select></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Position (Center) <span class="arrow">▼</span></h3><div class="accordion-content"><div class="slider-container mb-4"><label class="text-sm text-white mb-2 block">X</label> <input type="range" id="shapeXSlider" min="0" max="0" step="1" value="0" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>0</span> <span id="shapeXMax">0</span></div></div><div class="slider-container"><label class="text-sm text-white mb-2 block">Y</label> <input type="range" id="shapeYSlider" min="0" max="0" step="1" value="0" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>0</span> <span id="shapeYMax">0</span></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Dimensions <span class="arrow">▼</span></h3><div class="accordion-content"><div class="slider-container mb-4"><label class="text-sm text-white mb-2 block">Width</label> <input type="range" id="shapeWidthSlider" min="10" max="8000" step="1" value="50" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>10</span> <span>8000</span></div></div><div class="slider-container"><label class="text-sm text-white mb-2 block">Height</label> <input type="range" id="shapeHeightSlider" min="10" max="8000" step="1" value="50" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>10</span> <span>8000</span></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Falloff Fade <span class="arrow">▼</span></h3><div class="accordion-content"><div class="slider-container"><input type="range" id="falloffSlider" min="0" max="200" step="1" value="0" class="custom-slider"><div class="flex justify-between text-xs text-white opacity-70 mt-1"><span>Hard</span> <span>Soft</span></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Replacement <span class="arrow">▼</span></h3><div class="accordion-content"><label class="toggle-container"><input type="checkbox" id="shapeEraseToggle" class="toggle-input"> <span class="toggle-label">Erase (Transparent)</span></label><div id="shapeColorPickerContainer" class="mt-3 pl-6"><div class="flex items-center space-x-3"><input type="color" id="shapeReplacementColorPicker" value="#ff0000" class="color-picker"> <span class="text-sm text-white">Color: <span id="shapeReplacementColorDisplay" class="text-white font-mono">#FF0000</span></span></div></div></div></div><div class="accordion control-section"><h3 class="accordion-header control-title cursor-pointer flex justify-between items-center">Shape Preview <span class="arrow">▼</span></h3><div class="accordion-content"><label class="toggle-container"><input type="checkbox" id="shapeRealtimeToggle" class="toggle-input" checked="checked"> <span class="toggle-label">Real-time Shape Preview</span></label><p class="text-xs text-white opacity-70 mt-2">Updates on every slider move (may be slow for large shapes).</p></div></div></div></div></div></div></div><script>const imageUpload=document.getElementById("imageUpload"),imageCanvas=document.getElementById("imageCanvas"),ctx=imageCanvas.getContext("2d",{willReadFrequently:!0}),opacitySlider=document.getElementById("opacitySlider"),toleranceToggle=document.getElementById("toleranceToggle"),toleranceSliderContainer=document.getElementById("toleranceSliderContainer"),toleranceStrengthSlider=document.getElementById("toleranceStrengthSlider"),invertSelectionToggle=document.getElementById("invertSelectionToggle"),antiAliasingToggle=document.getElementById("antiAliasingToggle"),smoothingSliderContainer=document.getElementById("smoothingSliderContainer"),smoothingFactorSlider=document.getElementById("smoothingFactorSlider"),hexDisplay=document.getElementById("hexDisplay"),rgbDisplay=document.getElementById("rgbDisplay"),resolutionDisplay=document.getElementById("resolutionDisplay"),colorSwatch=document.getElementById("colorSwatch"),resetButton=document.getElementById("resetButton"),downloadButton=document.getElementById("downloadButton"),applyButton=document.getElementById("applyButton"),messageBox=document.getElementById("message-box"),messageText=document.getElementById("message-text"),copyHexButton=document.getElementById("copyHexButton"),copyRgbButton=document.getElementById("copyRgbButton"),colorReplacementToggle=document.getElementById("colorReplacementToggle"),colorPickerContainer=document.getElementById("colorPickerContainer"),replacementColorPicker=document.getElementById("replacementColorPicker"),replacementColorDisplay=document.getElementById("replacementColorDisplay"),realtimePreviewToggle=document.getElementById("realtimePreviewToggle"),previewButton=document.getElementById("previewButton"),performanceWarning=document.getElementById("performance-warning"),dismissWarning=document.getElementById("dismiss-warning"),areaSelectionToggle=document.getElementById("areaSelectionToggle"),shapeModeToggle=document.getElementById("shapeModeToggle"),shapeControls=document.getElementById("shapeControls"),shapeTypeSelect=document.getElementById("shapeTypeSelect"),shapeXSlider=document.getElementById("shapeXSlider"),shapeYSlider=document.getElementById("shapeYSlider"),shapeWidthSlider=document.getElementById("shapeWidthSlider"),shapeHeightSlider=document.getElementById("shapeHeightSlider"),falloffSlider=document.getElementById("falloffSlider"),shapeEraseToggle=document.getElementById("shapeEraseToggle"),shapeColorPickerContainer=document.getElementById("shapeColorPickerContainer"),shapeReplacementColorPicker=document.getElementById("shapeReplacementColorPicker"),shapeReplacementColorDisplay=document.getElementById("shapeReplacementColorDisplay"),shapeRealtimeToggle=document.getElementById("shapeRealtimeToggle"),shapeXMax=document.getElementById("shapeXMax"),shapeYMax=document.getElementById("shapeYMax");let originalImage=new Image,originalImageData=null,selectedColor=null,selectedAreaPixels=new Set,isAreaSelectionMode=!1,isRealtimePreviewEnabled=!0,isShapeModeEnabled=!1,isShapeRealtimeEnabled=!0,performanceCheckCount=0,totalProcessingTime=0,isPerformanceModeActive=!1,shapeCenterX=0,shapeCenterY=0,shapeWidth=50,shapeHeight=50,falloff=0,shapeType="rectangle",isShapeErase=!1,shapeReplacementColor={r:255,g:0,b:0};function showMessage(e,a){messageBox.classList.remove("hidden","bg-green-100","text-green-800","bg-red-100","text-red-800","bg-blue-100","text-blue-800"),messageText.textContent=e,"success"===a?messageBox.classList.add("bg-green-100","text-green-800"):"error"===a?messageBox.classList.add("bg-red-100","text-red-800"):messageBox.classList.add("bg-blue-100","text-blue-800"),setTimeout(()=>{messageBox.classList.add("hidden")},5e3)}function rgbToHex(e,a,t){return"#"+((1<<24)+(e<<16)+(a<<8)+t).toString(16).slice(1).toUpperCase()}function hexToRgb(e){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function colorDistance(e,a){const t=e.r-a.r,l=e.g-a.g,o=e.b-a.b;return Math.sqrt(.3*t*t+.59*l*l+.11*o*o)}function applyOpacityGamma(e){return Math.pow(e,2.2)}function smoothInterpolation(e,a){return e=Math.max(0,Math.min(1,e)),a<=.3?(1-Math.cos(e*Math.PI))/2:a<=.7?e*e*(3-2*e):e*e*e*(e*(6*e-15)+10)}function runFloodFill(e,a,t,l){if(!originalImageData)return;selectedAreaPixels.clear();const o=originalImageData.width,i=originalImageData.height,n=new Array(o*i).fill(!1),r=[{x:e,y:a}],s=(e,a)=>a*o+e,c=e=>{const a=originalImageData.data;return{r:a[4*e],g:a[4*e+1],b:a[4*e+2]}};for(;r.length>0;){const{x:e,y:a}=r.shift(),d=s(e,a);if(e<0||e>=o||a<0||a>=i||n[d])continue;colorDistance(t,c(d))<=l&&(n[d]=!0,selectedAreaPixels.add(`${e},${a}`),r.push({x:e+1,y:a}),r.push({x:e-1,y:a}),r.push({x:e,y:a+1}),r.push({x:e,y:a-1}))}}function applyShapeReplacement(e){if(!isShapeModeEnabled)return e;const a=e.data,t=e.width,l=e.height,o=shapeWidth/2,i=shapeHeight/2,n=Math.max(0,Math.floor(shapeCenterX-o-falloff)),r=Math.min(t-1,Math.ceil(shapeCenterX+o+falloff)),s=Math.max(0,Math.floor(shapeCenterY-i-falloff)),c=Math.min(l-1,Math.ceil(shapeCenterY+i+falloff));for(let e=s;e<=c;e++)for(let l=n;l<=r;l++){const n=4*(e*t+l);let r,s=0,c=(l-shapeCenterX)/o,d=(e-shapeCenterY)/i;if(r="rectangle"===shapeType?Math.max(Math.abs(c),Math.abs(d)):Math.sqrt(c*c+d*d),r<=1)s=1;else if(falloff>0&&r<=1+falloff/Math.min(o,i)){s=1-smoothInterpolation((r-1)/(falloff/Math.min(o,i)),.5)}s>0&&(isShapeErase?a[n+3]=Math.round(a[n+3]*(1-s)):(a[n]=Math.round(a[n]+(shapeReplacementColor.r-a[n])*s),a[n+1]=Math.round(a[n+1]+(shapeReplacementColor.g-a[n+1])*s),a[n+2]=Math.round(a[n+2]+(shapeReplacementColor.b-a[n+2])*s)))}return e}function applyFilter(e=!1){if(!isRealtimePreviewEnabled&&!e)return;const a=performance.now();if(!originalImageData)return void(originalImage.src&&ctx.drawImage(originalImage,0,0));let t=new ImageData(new Uint8ClampedArray(originalImageData.data),originalImageData.width,originalImageData.height);if(t=applyShapeReplacement(t),selectedColor){const e=t.data,a=parseFloat(opacitySlider.value),l=toleranceToggle.checked,o=invertSelectionToggle.checked,i=parseFloat(toleranceStrengthSlider.value),n=colorReplacementToggle.checked,r=n?hexToRgb(replacementColorPicker.value):null,s=antiAliasingToggle.checked;isAreaSelectionMode=areaSelectionToggle.checked;for(let c=0;c<e.length;c+=4){const d=e[c],g=e[c+1],h=e[c+2],p=originalImageData.data[c+3];let m=0;if(isAreaSelectionMode){const e=`${c/4%t.width},${Math.floor(c/4/t.width)}`;if(selectedAreaPixels.has(e))if(s&&l&&i>0){const e=colorDistance(selectedColor,{r:d,g:g,b:h});if(e<=i){const a=parseFloat(smoothingFactorSlider.value),t=i*a,l=i-t;if(e<=l)m=o?0:1;else{const i=smoothInterpolation((e-l)/t,a);m=o?i:1-i}}else m=o?0:1}else m=o?0:1;else m=o?1:0}else{const e=l?colorDistance(selectedColor,{r:d,g:g,b:h}):d===selectedColor.r&&g===selectedColor.g&&h===selectedColor.b?0:1/0;if(l)if(e<=i)if(s&&i>0){const a=parseFloat(smoothingFactorSlider.value),t=i*a,l=i-t;if(e<=l)m=o?0:1;else{const i=smoothInterpolation((e-l)/t,a);m=o?i:1-i}}else m=o?0:1;else m=o?1:0;else m=0===e?o?0:1:o?1:0}if(m>0)if(n)e[c]=Math.round(d+(r.r-d)*m),e[c+1]=Math.round(g+(r.g-g)*m),e[c+2]=Math.round(h+(r.b-h)*m),e[c+3]=p;else{const t=applyOpacityGamma(a);e[c+3]=p*(1-t*m)}else e[c+3]=p}}ctx.putImageData(t,0,0);const l=performance.now()-a;if(isRealtimePreviewEnabled&&!e)if(performanceCheckCount++,totalProcessingTime+=l,l>750)showPerformanceWarning();else if(performanceCheckCount>=2){totalProcessingTime/performanceCheckCount>750&&showPerformanceWarning(),performanceCheckCount=0,totalProcessingTime=0}}function loadImage(e){const a=e.target.files[0];if(!a)return;const t=new FileReader;t.onload=function(e){originalImage=new Image,originalImage.onload=function(){imageCanvas.width=originalImage.width,imageCanvas.height=originalImage.height,resolutionDisplay.textContent=`${originalImage.width} × ${originalImage.height}`,ctx.drawImage(originalImage,0,0),originalImageData=ctx.getImageData(0,0,imageCanvas.width,imageCanvas.height),showMessage("Image loaded successfully! Click on the image to pick a color or enable Shape Mode.","success"),selectedColor=null,opacitySlider.value=0,toleranceToggle.checked=!0,toleranceSliderContainer.classList.remove("hidden"),toleranceStrengthSlider.value=20,invertSelectionToggle.checked=!1,antiAliasingToggle.checked=!0,smoothingSliderContainer.classList.remove("hidden"),smoothingFactorSlider.value=1,colorReplacementToggle.checked=!1,colorPickerContainer.classList.add("hidden"),replacementColorPicker.value="#ff0000",replacementColorDisplay.textContent="#FF0000",areaSelectionToggle.checked=!1,selectedAreaPixels.clear(),hexDisplay.textContent="#FFFFFF",rgbDisplay.textContent="rgb(255, 255, 255)",colorSwatch.style.backgroundColor="#FFFFFF",isShapeModeEnabled=!1,shapeModeToggle.checked=!1,shapeControls.classList.remove("active"),shapeTypeSelect.value="rectangle",shapeXSlider.max=originalImage.width,shapeXSlider.value=originalImage.width/2,shapeYSlider.max=originalImage.height,shapeYSlider.value=originalImage.height/2,shapeXMax.textContent=originalImage.width,shapeYMax.textContent=originalImage.height,shapeWidthSlider.value=50,shapeHeightSlider.value=50,falloffSlider.value=0,shapeEraseToggle.checked=!1,shapeReplacementColorPicker.value="#ff0000",shapeReplacementColorDisplay.textContent="#FF0000",shapeRealtimeToggle.checked=!0,isRealtimePreviewEnabled=!0,realtimePreviewToggle.checked=!0,realtimePreviewToggle.classList.remove("disabled"),realtimePreviewToggle.parentElement.classList.remove("disabled"),previewButton.classList.add("hidden"),hidePerformanceWarning(),performanceCheckCount=0,totalProcessingTime=0,isPerformanceModeActive=!1,updateShapeState()},originalImage.src=e.target.result},t.readAsDataURL(a)}function pickColor(e){if(!originalImageData)return void showMessage("Please upload an image first.","info");const a=imageCanvas.getBoundingClientRect(),t=imageCanvas.width/a.width,l=imageCanvas.height/a.height,o=Math.floor((e.clientX-a.left)*t),i=Math.floor((e.clientY-a.top)*l),n=ctx.getImageData(o,i,1,1).data,r={r:n[0],g:n[1],b:n[2]};if(isShapeModeEnabled){shapeReplacementColor=r;const e=rgbToHex(r.r,r.g,r.b);shapeReplacementColorPicker.value=e,shapeReplacementColorDisplay.textContent=e.toUpperCase(),showMessage("Replacement color picked for shape!","info"),applyFilter(!0)}else{if(selectedColor=r,hexDisplay.textContent=rgbToHex(selectedColor.r,selectedColor.g,selectedColor.b),rgbDisplay.textContent=`rgb(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b})`,colorSwatch.style.backgroundColor=`rgb(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b})`,isAreaSelectionMode=areaSelectionToggle.checked,isAreaSelectionMode){const e=parseFloat(toleranceStrengthSlider.value);runFloodFill(o,i,selectedColor,e),showMessage("Area picked! Adjust settings to see the effect.","info")}else selectedAreaPixels.clear(),showMessage("Color picked! Adjust settings.","info");applyFilter(!0)}}function showPerformanceWarning(){isPerformanceModeActive||(isPerformanceModeActive=!0,performanceWarning.classList.remove("hidden"),isRealtimePreviewEnabled=!1,realtimePreviewToggle.checked=!1,realtimePreviewToggle.classList.add("disabled"),realtimePreviewToggle.parentElement.classList.add("disabled"),previewButton.classList.remove("hidden"),showMessage("Real-time preview disabled due to performance","info"))}function hidePerformanceWarning(){performanceWarning.classList.add("hidden")}function toggleRealtimePreview(e){isRealtimePreviewEnabled=e,e?(previewButton.classList.add("hidden"),realtimePreviewToggle.classList.remove("disabled"),realtimePreviewToggle.parentElement.classList.remove("disabled"),performanceCheckCount=0,totalProcessingTime=0,isPerformanceModeActive=!1):previewButton.classList.remove("hidden")}function updateShapeState(e=!1){shapeCenterX=parseFloat(shapeXSlider.value),shapeCenterY=parseFloat(shapeYSlider.value),shapeWidth=parseFloat(shapeWidthSlider.value),shapeHeight=parseFloat(shapeHeightSlider.value),falloff=parseFloat(falloffSlider.value),shapeType=shapeTypeSelect.value,isShapeErase=shapeEraseToggle.checked,shapeReplacementColor=hexToRgb(shapeReplacementColorPicker.value),isShapeModeEnabled&&(isShapeRealtimeEnabled||e)&&applyFilter()}function resetImage(){originalImage.src?(ctx.drawImage(originalImage,0,0),originalImageData=ctx.getImageData(0,0,imageCanvas.width,imageCanvas.height),selectedColor=null,opacitySlider.value=0,toleranceToggle.checked=!0,toleranceSliderContainer.classList.remove("hidden"),toleranceStrengthSlider.value=20,invertSelectionToggle.checked=!1,antiAliasingToggle.checked=!0,smoothingSliderContainer.classList.remove("hidden"),smoothingFactorSlider.value=1,colorReplacementToggle.checked=!1,colorPickerContainer.classList.add("hidden"),replacementColorPicker.value="#ff0000",replacementColorDisplay.textContent="#FF0000",areaSelectionToggle.checked=!1,selectedAreaPixels.clear(),hexDisplay.textContent="#FFFFFF",rgbDisplay.textContent="rgb(255, 255, 255)",colorSwatch.style.backgroundColor="#FFFFFF",isShapeModeEnabled=!1,shapeModeToggle.checked=!1,shapeControls.classList.remove("active"),shapeTypeSelect.value="rectangle",shapeXSlider.value=imageCanvas.width/2,shapeYSlider.value=imageCanvas.height/2,shapeWidthSlider.value=50,shapeHeightSlider.value=50,falloffSlider.value=0,shapeEraseToggle.checked=!1,shapeReplacementColorPicker.value="#ff0000",shapeReplacementColorDisplay.textContent="#FF0000",shapeRealtimeToggle.checked=!0,isRealtimePreviewEnabled=!0,realtimePreviewToggle.checked=!0,realtimePreviewToggle.classList.remove("disabled"),realtimePreviewToggle.parentElement.classList.remove("disabled"),previewButton.classList.add("hidden"),hidePerformanceWarning(),performanceCheckCount=0,totalProcessingTime=0,isPerformanceModeActive=!1,showMessage("Image reset to original state.","info")):showMessage("No image loaded to reset.","info")}function applyChanges(){originalImageData?(originalImageData=ctx.getImageData(0,0,imageCanvas.width,imageCanvas.height),selectedColor=null,opacitySlider.value=0,toleranceToggle.checked=!0,toleranceSliderContainer.classList.remove("hidden"),toleranceStrengthSlider.value=20,invertSelectionToggle.checked=!1,antiAliasingToggle.checked=!0,smoothingSliderContainer.classList.remove("hidden"),smoothingFactorSlider.value=1,colorReplacementToggle.checked=!1,colorPickerContainer.classList.add("hidden"),replacementColorPicker.value="#ff0000",replacementColorDisplay.textContent="#FF0000",areaSelectionToggle.checked=!1,selectedAreaPixels.clear(),hexDisplay.textContent="#FFFFFF",rgbDisplay.textContent="rgb(255, 255, 255)",colorSwatch.style.backgroundColor="#FFFFFF",isShapeModeEnabled=!1,shapeModeToggle.checked=!1,shapeControls.classList.remove("active"),shapeTypeSelect.value="rectangle",shapeXSlider.value=imageCanvas.width/2,shapeYSlider.value=imageCanvas.height/2,shapeWidthSlider.value=50,shapeHeightSlider.value=50,falloffSlider.value=0,shapeEraseToggle.checked=!1,shapeReplacementColorPicker.value="#ff0000",shapeReplacementColorDisplay.textContent="#FF0000",shapeRealtimeToggle.checked=!0,isRealtimePreviewEnabled=!0,realtimePreviewToggle.checked=!0,realtimePreviewToggle.classList.remove("disabled"),realtimePreviewToggle.parentElement.classList.remove("disabled"),previewButton.classList.add("hidden"),hidePerformanceWarning(),performanceCheckCount=0,totalProcessingTime=0,isPerformanceModeActive=!1,showMessage("Changes applied! Ready for new edits.","success")):showMessage("Please upload an image first.","info")}function downloadImage(){if(!originalImageData)return void showMessage("Please upload and edit an image first.","info");const e=imageCanvas.toDataURL("image/png"),a=document.createElement("a");a.href=e,a.download="edited-image.png",a.click(),showMessage("Image downloaded!","success")}async function copyToClipboard(e,a){try{await navigator.clipboard.writeText(e),showMessage(`${a} copied!`,"success")}catch(e){showMessage("Copy failed.","error")}}imageUpload.addEventListener("change",loadImage),imageCanvas.addEventListener("click",pickColor),opacitySlider.addEventListener("input",()=>{isRealtimePreviewEnabled&&applyFilter()}),toleranceToggle.addEventListener("change",()=>{toleranceSliderContainer.classList.toggle("hidden",!toleranceToggle.checked),isRealtimePreviewEnabled&&applyFilter()}),toleranceStrengthSlider.addEventListener("input",()=>{isRealtimePreviewEnabled&&applyFilter()}),invertSelectionToggle.addEventListener("change",()=>{isRealtimePreviewEnabled&&applyFilter()}),antiAliasingToggle.addEventListener("change",()=>{smoothingSliderContainer.classList.toggle("hidden",!antiAliasingToggle.checked),isRealtimePreviewEnabled&&applyFilter()}),smoothingFactorSlider.addEventListener("input",()=>{isRealtimePreviewEnabled&&applyFilter()}),resetButton.addEventListener("click",resetImage),downloadButton.addEventListener("click",downloadImage),applyButton.addEventListener("click",applyChanges),copyHexButton.addEventListener("click",()=>copyToClipboard(hexDisplay.textContent,"Hex")),copyRgbButton.addEventListener("click",()=>copyToClipboard(rgbDisplay.textContent,"RGB")),colorReplacementToggle.addEventListener("change",()=>{colorPickerContainer.classList.toggle("hidden",!colorReplacementToggle.checked),isRealtimePreviewEnabled&&applyFilter()}),replacementColorPicker.addEventListener("input",()=>{replacementColorDisplay.textContent=replacementColorPicker.value.toUpperCase(),isRealtimePreviewEnabled&&applyFilter()}),realtimePreviewToggle.addEventListener("change",()=>toggleRealtimePreview(realtimePreviewToggle.checked)),previewButton.addEventListener("click",()=>applyFilter(!0)),dismissWarning.addEventListener("click",hidePerformanceWarning),areaSelectionToggle.addEventListener("change",()=>{isRealtimePreviewEnabled&&applyFilter()}),shapeModeToggle.addEventListener("change",()=>{isShapeModeEnabled=shapeModeToggle.checked,shapeControls.classList.toggle("active",shapeModeToggle.checked),showMessage(isShapeModeEnabled?"Shape Mode enabled. Click image to pick replacement color.":"Shape Mode disabled.","info"),applyFilter()}),shapeTypeSelect.addEventListener("change",()=>updateShapeState()),shapeEraseToggle.addEventListener("change",()=>updateShapeState()),shapeReplacementColorPicker.addEventListener("input",()=>{shapeReplacementColorDisplay.textContent=shapeReplacementColorPicker.value.toUpperCase(),updateShapeState()}),shapeRealtimeToggle.addEventListener("change",()=>{isShapeRealtimeEnabled=shapeRealtimeToggle.checked});const shapeSliders=[shapeXSlider,shapeYSlider,shapeWidthSlider,shapeHeightSlider,falloffSlider];shapeSliders.forEach(e=>{e.addEventListener("input",()=>{isShapeRealtimeEnabled&&updateShapeState()}),e.addEventListener("mouseup",()=>{isShapeRealtimeEnabled||updateShapeState(!0)})});const accordionHeaders=document.querySelectorAll(".accordion-header");accordionHeaders.forEach(e=>{e.addEventListener("click",()=>{e.parentElement.classList.toggle("active")})}),window.onload=()=>{imageCanvas.width=600,imageCanvas.height=400,ctx.fillStyle="#e2e8f0",ctx.fillRect(0,0,600,400),ctx.font="24px Inter",ctx.textAlign="center",ctx.fillStyle="#64748b",ctx.fillText("Upload an image to get started",300,200)}</script></body></html>