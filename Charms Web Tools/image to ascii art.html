<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASCII Art Converter</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #000000;
      --fg: #ffffff;
      --muted: rgba(255, 255, 255, 0.5);
      --accent: #ffffff;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background: var(--bg);
      color: var(--fg);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated background */
    .bg-pattern {
      position: fixed;
      inset: 0;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(255,255,255,0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.03) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .scanlines {
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.01) 2px,
        rgba(255, 255, 255, 0.01) 4px
      );
      pointer-events: none;
      z-index: 1;
      animation: scanMove 8s linear infinite;
    }

    @keyframes scanMove {
      0% { transform: translateY(0); }
      100% { transform: translateY(4px); }
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      min-height: 100vh;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .logo {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.05em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo-blink {
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .btn {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 0.875rem;
      font-weight: 600;
      padding: 0.75rem 1.25rem;
      background: var(--fg);
      color: var(--bg);
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s ease;
    }

    .btn:hover::before {
      transform: translateX(100%);
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:focus-visible {
      outline: 2px solid var(--fg);
      outline-offset: 2px;
    }

    .btn-outline {
      background: transparent;
      color: var(--fg);
      border: 1px solid var(--fg);
    }

    .btn-outline:hover {
      background: var(--fg);
      color: var(--bg);
    }

    .main-grid {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 2rem;
      min-height: calc(100vh - 8rem);
    }

    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .panel {
      background: rgba(255, 255, 255, 0.02);
      padding: 1.25rem;
    }

    .panel-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
      color: var(--muted);
    }

    .upload-zone {
      aspect-ratio: 16/10;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .upload-zone.dragging {
      background: rgba(255, 255, 255, 0.05);
    }

    .upload-zone input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .upload-icon {
      width: 48px;
      height: 48px;
      margin-bottom: 1rem;
      opacity: 0.5;
      transition: all 0.3s ease;
    }

    .upload-zone:hover .upload-icon {
      opacity: 1;
      transform: translateY(-4px);
    }

    .upload-text {
      font-size: 0.875rem;
      color: var(--muted);
      text-align: center;
    }

    .preview-thumb {
      width: 100%;
      aspect-ratio: 16/10;
      object-fit: contain;
      display: none;
    }

    .preview-thumb.visible {
      display: block;
    }

    .control-group {
      margin-bottom: 1.25rem;
    }

    .control-group:last-child {
      margin-bottom: 0;
    }

    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8125rem;
      margin-bottom: 0.5rem;
    }

    .control-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--muted);
    }

    input[type="range"] {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      appearance: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: var(--fg);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    input[type="range"]:focus-visible {
      outline: none;
    }

    input[type="range"]:focus-visible::-webkit-slider-thumb {
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    .charset-input {
      width: 100%;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      padding: 0.75rem;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--fg);
      transition: border-color 0.2s ease;
    }

    .charset-input:focus {
      outline: none;
      border-color: var(--fg);
    }

    .charset-input::placeholder {
      color: var(--muted);
    }

    .presets {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .preset-btn {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.6875rem;
      padding: 0.375rem 0.625rem;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .preset-btn:hover {
      border-color: var(--fg);
      color: var(--fg);
    }

    .preset-btn:focus-visible {
      outline: 2px solid var(--fg);
      outline-offset: 2px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
    }

    .checkbox {
      width: 20px;
      height: 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .checkbox.checked {
      background: var(--fg);
    }

    .checkbox svg {
      width: 14px;
      height: 14px;
      stroke: var(--bg);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .checkbox.checked svg {
      opacity: 1;
    }

    .checkbox-label {
      font-size: 0.875rem;
    }

    .output-area {
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.02);
      min-height: 500px;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.02);
    }

    .output-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--muted);
    }

    .output-stats {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .output-content {
      flex: 1;
      overflow: auto;
      padding: 1rem;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .ascii-output {
      font-family: 'JetBrains Mono', monospace;
      font-size: 6px;
      line-height: 1;
      letter-spacing: 0;
      white-space: pre;
      color: var(--fg);
      user-select: all;
    }

    .placeholder-text {
      color: var(--muted);
      font-size: 1rem;
      text-align: center;
      padding: 3rem;
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--fg);
      color: var(--bg);
      padding: 1rem 1.5rem;
      font-weight: 600;
      font-size: 0.875rem;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 100;
    }

    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Animation */
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <div class="bg-pattern"></div>
  <div class="scanlines"></div>

  <div class="container">
    <header>
      <div class="logo">
        <span>ASCII</span>
        <span class="logo-blink">_</span>
      </div>
      <div class="actions">
        <button class="btn btn-outline" id="copyBtn" disabled>Copy to Clipboard</button>
        <button class="btn btn-outline" id="exportTxtBtn" disabled>Export TXT</button>
        <button class="btn" id="exportPngBtn" disabled>Export PNG</button>
      </div>
    </header>

    <div class="main-grid">
      <aside class="sidebar">
        <div class="panel">
          <div class="panel-title">Source Image</div>
          <div class="upload-zone" id="uploadZone">
            <input type="file" id="fileInput" accept="image/*" aria-label="Upload image">
            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <span class="upload-text">Drop image or click to upload</span>
            <img class="preview-thumb" id="previewThumb" alt="Preview">
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Settings</div>
          
          <div class="control-group">
            <div class="control-label">
              <span>Width</span>
              <span class="control-value" id="widthValue">120</span>
            </div>
            <input type="range" id="widthSlider" min="40" max="200" value="120">
          </div>

          <div class="control-group">
            <div class="control-label">
              <span>Contrast</span>
              <span class="control-value" id="contrastValue">1.0</span>
            </div>
            <input type="range" id="contrastSlider" min="0.5" max="2" step="0.1" value="1">
          </div>

          <div class="control-group">
            <div class="control-label">
              <span>Brightness</span>
              <span class="control-value" id="brightnessValue">0</span>
            </div>
            <input type="range" id="brightnessSlider" min="-50" max="50" value="0">
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Character Set</div>
          <input 
            type="text" 
            class="charset-input" 
            id="charsetInput" 
            value=" .:-=+*#%@"
            placeholder="Enter characters..."
            aria-label="Custom character set"
          >
          <div class="presets">
            <button class="preset-btn" data-charset=" .:-=+*#%@" aria-label="Standard charset">Standard</button>
            <button class="preset-btn" data-charset=" .:;+=xX$&" aria-label="Blocky charset">Blocky</button>
            <button class="preset-btn" data-charset=" .-:;=/+xX#@" aria-label="Detailed charset">Detailed</button>
            <button class="preset-btn" data-charset=" ░▒▓█" aria-label="Blocks charset">Blocks</button>
            <button class="preset-btn" data-charset=" .:|/XNW" aria-label="Sharp charset">Sharp</button>
          </div>

          <div class="control-group" style="margin-top: 1rem;">
            <div class="checkbox-group" id="invertToggle" role="checkbox" aria-checked="false" tabindex="0">
              <div class="checkbox">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
              </div>
              <span class="checkbox-label">Invert</span>
            </div>
          </div>
        </div>
      </aside>

      <main class="output-area">
        <div class="output-header">
          <span class="output-title">Output</span>
          <span class="output-stats" id="outputStats">0 x 0</span>
        </div>
        <div class="output-content" id="outputContent">
          <p class="placeholder-text">Upload an image to convert to ASCII art</p>
        </div>
      </main>
    </div>
  </div>

  <div class="toast" id="toast">Copied to clipboard</div>

  <canvas id="canvas"></canvas>

  <script>
    // DOM Elements
    const fileInput = document.getElementById('fileInput');
    const uploadZone = document.getElementById('uploadZone');
    const previewThumb = document.getElementById('previewThumb');
    const widthSlider = document.getElementById('widthSlider');
    const widthValue = document.getElementById('widthValue');
    const contrastSlider = document.getElementById('contrastSlider');
    const contrastValue = document.getElementById('contrastValue');
    const brightnessSlider = document.getElementById('brightnessSlider');
    const brightnessValue = document.getElementById('brightnessValue');
    const charsetInput = document.getElementById('charsetInput');
    const invertToggle = document.getElementById('invertToggle');
    const checkbox = invertToggle.querySelector('.checkbox');
    const outputContent = document.getElementById('outputContent');
    const outputStats = document.getElementById('outputStats');
    const copyBtn = document.getElementById('copyBtn');
    const exportTxtBtn = document.getElementById('exportTxtBtn');
    const exportPngBtn = document.getElementById('exportPngBtn');
    const toast = document.getElementById('toast');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    // State
    let currentImage = null;
    let currentAscii = '';
    let isInverted = false;

    // Presets
    document.querySelectorAll('.preset-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        charsetInput.value = btn.dataset.charset;
        if (currentImage) convertImage();
      });
    });

    // File upload
    fileInput.addEventListener('change', handleFile);
    
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragging');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragging');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragging');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        loadImage(file);
      }
    });

    function handleFile(e) {
      const file = e.target.files[0];
      if (file) {
        loadImage(file);
      }
    }

    function loadImage(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          currentImage = img;
          previewThumb.src = e.target.result;
          previewThumb.classList.add('visible');
          uploadZone.querySelector('.upload-icon').style.display = 'none';
          uploadZone.querySelector('.upload-text').style.display = 'none';
          enableButtons();
          convertImage();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function enableButtons() {
      copyBtn.disabled = false;
      exportTxtBtn.disabled = false;
      exportPngBtn.disabled = false;
    }

    // Sliders
    widthSlider.addEventListener('input', () => {
      widthValue.textContent = widthSlider.value;
      if (currentImage) convertImage();
    });

    contrastSlider.addEventListener('input', () => {
      contrastValue.textContent = parseFloat(contrastSlider.value).toFixed(1);
      if (currentImage) convertImage();
    });

    brightnessSlider.addEventListener('input', () => {
      brightnessValue.textContent = brightnessSlider.value;
      if (currentImage) convertImage();
    });

    // Charset
    charsetInput.addEventListener('input', () => {
      if (currentImage) convertImage();
    });

    // Invert toggle
    invertToggle.addEventListener('click', toggleInvert);
    invertToggle.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleInvert();
      }
    });

    function toggleInvert() {
      isInverted = !isInverted;
      checkbox.classList.toggle('checked', isInverted);
      invertToggle.setAttribute('aria-checked', isInverted);
      if (currentImage) convertImage();
    }

    // Convert image to ASCII
    function convertImage() {
      if (!currentImage) return;

      const width = parseInt(widthSlider.value);
      const aspectRatio = currentImage.height / currentImage.width;
      const height = Math.floor(width * aspectRatio * 0.5);

      canvas.width = width;
      canvas.height = height;
      ctx.drawImage(currentImage, 0, 0, width, height);

      const imageData = ctx.getImageData(0, 0, width, height);
      const pixels = imageData.data;

      const contrast = parseFloat(contrastSlider.value);
      const brightness = parseInt(brightnessSlider.value);
      let charset = charsetInput.value || ' .:-=+*#%@';
      
      if (isInverted) {
        charset = charset.split('').reverse().join('');
      }

      let ascii = '';

      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const i = (y * width + x) * 4;
          let r = pixels[i];
          let g = pixels[i + 1];
          let b = pixels[i + 2];

          // Apply brightness
          r += brightness;
          g += brightness;
          b += brightness;

          // Apply contrast
          r = ((r - 128) * contrast) + 128;
          g = ((g - 128) * contrast) + 128;
          b = ((b - 128) * contrast) + 128;

          // Clamp values
          r = Math.max(0, Math.min(255, r));
          g = Math.max(0, Math.min(255, g));
          b = Math.max(0, Math.min(255, b));

          // Calculate luminance
          const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
          
          // Map to character
          const charIndex = Math.floor((luminance / 255) * (charset.length - 1));
          ascii += charset[Math.max(0, Math.min(charset.length - 1, charIndex))];
        }
        ascii += '\n';
      }

      currentAscii = ascii;
      renderAscii(ascii, width, height);
    }

    function renderAscii(ascii, width, height) {
      outputContent.innerHTML = '';
      const pre = document.createElement('pre');
      pre.className = 'ascii-output fade-in';
      pre.textContent = ascii;
      outputContent.appendChild(pre);
      outputStats.textContent = `${width} x ${height}`;
    }

    // Copy to clipboard
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(currentAscii);
        showToast('Copied to clipboard');
      } catch (err) {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = currentAscii;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast('Copied to clipboard');
      }
    });

    // Export TXT
    exportTxtBtn.addEventListener('click', () => {
      const blob = new Blob([currentAscii], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ascii-art.txt';
      a.click();
      URL.revokeObjectURL(url);
      showToast('Exported as TXT');
    });

    // Export PNG
    exportPngBtn.addEventListener('click', () => {
      const lines = currentAscii.split('\n').filter(l => l.length > 0);
      if (lines.length === 0) return;

      const fontSize = 10;
      const charWidth = 6;
      const lineHeight = fontSize + 2;
      
      const maxLineLength = Math.max(...lines.map(l => l.length));
      const imgWidth = maxLineLength * charWidth;
      const imgHeight = lines.length * lineHeight;

      const exportCanvas = document.createElement('canvas');
      exportCanvas.width = imgWidth;
      exportCanvas.height = imgHeight;
      const exportCtx = exportCanvas.getContext('2d');

      exportCtx.fillStyle = '#000000';
      exportCtx.fillRect(0, 0, imgWidth, imgHeight);

      exportCtx.font = `${fontSize}px "JetBrains Mono", monospace`;
      exportCtx.fillStyle = '#ffffff';
      exportCtx.textBaseline = 'top';

      lines.forEach((line, i) => {
        exportCtx.fillText(line, 0, i * lineHeight);
      });

      const url = exportCanvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ascii-art.png';
      a.click();
      showToast('Exported as PNG');
    });

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('visible');
      setTimeout(() => {
        toast.classList.remove('visible');
      }, 2000);
    }

    // Initial animation
    document.querySelectorAll('.panel').forEach((panel, i) => {
      panel.style.opacity = '0';
      panel.style.transform = 'translateY(20px)';
      setTimeout(() => {
        panel.style.transition = 'all 0.5s ease';
        panel.style.opacity = '1';
        panel.style.transform = 'translateY(0)';
      }, 100 + i * 100);
    });
  </script>
</body>
</html>